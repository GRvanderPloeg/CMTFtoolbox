[{"path":"https://grvanderploeg.com/CMTFtoolbox/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2024 CMTFtoolbox authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/AP.html","id":"preamble","dir":"Articles","previous_headings":"","what":"Preamble","title":"AP","text":"","code":"library(dplyr) #>  #> Attaching package: 'dplyr' #> The following objects are masked from 'package:stats': #>  #>     filter, lag #> The following objects are masked from 'package:base': #>  #>     intersect, setdiff, setequal, union library(tidyr) library(parafac4microbiome) library(NPLStoolbox) library(CMTFtoolbox) #>  #> Attaching package: 'CMTFtoolbox' #> The following object is masked from 'package:NPLStoolbox': #>  #>     npred #> The following objects are masked from 'package:parafac4microbiome': #>  #>     fac_to_vect, reinflateFac, reinflateTensor, vect_to_fac library(ggplot2) library(ggpubr) library(scales) library(stringr) testMetadata = function(model, comp, metadata){    transformedSubjectLoadings = model$Fac[[1]][,comp]   transformedSubjectLoadings = transformedSubjectLoadings / norm(transformedSubjectLoadings, \"2\")      metadata = metadata$mode1 %>% left_join(ageInfo, by=\"SubjectID\") %>% mutate(Gender=as.numeric(as.factor(Gender), PainS_NopainA=as.numeric(as.factor(PainS_NopainA))))   result = lm(transformedSubjectLoadings ~ Gender + Age + PainS_NopainA, data=metadata)      # Extract coefficients and confidence intervals   coef_estimates <- summary(result)$coefficients   conf_intervals <- confint(result)      # Remove intercept   coef_estimates <- coef_estimates[rownames(coef_estimates) != \"(Intercept)\", ]   conf_intervals <- conf_intervals[rownames(conf_intervals) != \"(Intercept)\", ]      # Combine into a clean data frame   summary_table <- data.frame(     Term     = rownames(coef_estimates),     Estimate = coef_estimates[, \"Estimate\"] * 1e3,     CI       = paste0(                  conf_intervals[, 1], \" – \",                  conf_intervals[, 2]                ),     P_value  = coef_estimates[, \"Pr(>|t|)\"],     P_adjust = p.adjust(coef_estimates[, \"Pr(>|t|)\"], \"BH\"),     row.names = NULL   )      return(summary_table) } cytokines_meta_data = read.csv(\"./AP/input_deduplicated_metadata_RvdP.csv\", sep=\" \", header=FALSE) %>% as_tibble() colnames(cytokines_meta_data) = c(\"SubjectID\", \"Visit\", \"Gender\", \"Age\", \"Pain_noPain\", \"case_control\") ageInfo = cytokines_meta_data %>% select(SubjectID, Age) %>% unique()"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/AP.html","id":"processing","dir":"Articles","previous_headings":"ACMTF","what":"Processing","title":"AP","text":"","code":"# Microbiome processedMicrobiome = CMTFtoolbox::Georgiou2025$Tooth_microbiome  # Remove samples due to low library size mask = rowSums(processedMicrobiome$data) > 6500 processedMicrobiome$data = processedMicrobiome$data[mask,] processedMicrobiome$mode1 = processedMicrobiome$mode1[mask,]  # Remove duplicate samples mask = !(processedMicrobiome$mode1$SampleID %in% c(\"A11-8 36\", \"A11-10 17\", \"A11-15 17\")) processedMicrobiome$data = processedMicrobiome$data[mask,] processedMicrobiome$mode1 = processedMicrobiome$mode1[mask,]  # Also remove subject A11-8 due to being an outlier processedMicrobiome$data = processedMicrobiome$data[-23,,] processedMicrobiome$mode1 = processedMicrobiome$mode1[-23,]  # CLR transformation df = processedMicrobiome$data + 1 geomeans = pracma::geomean(as.matrix(df), dim=2) df_clr = log(sweep(df, 1, geomeans, FUN=\"/\"))  # Feature filtering sparsityThreshold = 0.5 maskA = processedMicrobiome$mode1$PainS_NopainA == \"A\" maskS = processedMicrobiome$mode1$PainS_NopainA == \"S\"  dfA = processedMicrobiome$data[maskA,] dfS = processedMicrobiome$data[maskS,]  sparsityA = colSums(dfA == 0) / nrow(dfA) sparsityS = colSums(dfS == 0) / nrow(dfS)  mask = (sparsityA <= sparsityThreshold) | (sparsityS <= sparsityThreshold)  processedMicrobiome$data = df_clr[,mask] processedMicrobiome$mode2 = processedMicrobiome$mode2[mask,]  # Center and scale processedMicrobiome$data = sweep(processedMicrobiome$data, 2, colMeans(processedMicrobiome$data), FUN=\"-\") processedMicrobiome$data = sweep(processedMicrobiome$data, 2, apply(processedMicrobiome$data, 2, sd), FUN=\"/\")  # Cytokines processedCytokines_case = CMTFtoolbox::Georgiou2025$Inflammatory_mediators  # Select only case subjects mask = processedCytokines_case$mode1$case_control == \"case\" processedCytokines_case$data = processedCytokines_case$data[mask,,] processedCytokines_case$mode1 = processedCytokines_case$mode1[mask,]  # Select only samples with corresponding microbiome data mask = processedCytokines_case$mode1$SubjectID %in% processedMicrobiome$mode1$SubjectID processedCytokines_case$data = processedCytokines_case$data[mask,,] processedCytokines_case$mode1 = processedCytokines_case$mode1[mask,]  processedCytokines_case$data = log(processedCytokines_case$data + 0.005) processedCytokines_case$data = multiwayCenter(processedCytokines_case$data, 1) processedCytokines_case$data = multiwayScale(processedCytokines_case$data, 2)  # Prep data datasets = list(processedCytokines_case$data, as.matrix(processedMicrobiome$data)) modes = list(c(1,2,3),c(1,4)) Z = setupCMTFdata(datasets, modes, normalize=TRUE)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/AP.html","id":"model-selection","dir":"Articles","previous_headings":"ACMTF","what":"Model selection","title":"AP","text":"","code":"# Please see the separate R scripts at https://doi.org/10.5281/zenodo.16993009 for the model selection. acmtf_model = readRDS(\"./AP/acmtf_model.RDS\") testMetadata(acmtf_model, 1, processedCytokines_case) #>             Term    Estimate                                        CI #> 1         Gender -149.940307   -0.25535437485488 – -0.0445262394204995 #> 2            Age    5.722737 0.00215228707320942 – 0.00929318627499447 #> 3 PainS_NopainAS -248.309324   -0.354751990816222 – -0.141866656819693 #>        P_value     P_adjust #> 1 0.0077442196 0.0077442196 #> 2 0.0033282605 0.0049923907 #> 3 0.0001033877 0.0003101631 testMetadata(acmtf_model, 2, processedCytokines_case) #>             Term    Estimate                                         CI #> 1         Gender   74.084420      -0.072295300642858 – 0.22046414000031 #> 2            Age   -9.252744 -0.0142107298938554 – -0.00429475899321387 #> 3 PainS_NopainAS -102.952690    -0.250760740295701 – 0.0448553603426137 #>       P_value    P_adjust #> 1 0.302743519 0.302743519 #> 2 0.000949563 0.002848689 #> 3 0.161212681 0.241819021 lambda = abs(acmtf_model$Fac[[5]]) colnames(lambda) = paste0(\"C\", 1:2)  lambda %>%   as_tibble() %>%   mutate(block=c(\"cytokines\", \"microbiome\")) %>%   mutate(block=factor(block, levels=c(\"cytokines\", \"microbiome\"))) %>%   pivot_longer(-block) %>%   ggplot(aes(x=as.factor(name),y=value,fill=as.factor(block))) +   geom_bar(stat=\"identity\",position=position_dodge(),col=\"black\") +   xlab(\"ACMTF component number\") +   ylab(expression(lambda)) +   scale_x_discrete(labels=1:3) +   scale_fill_manual(name=\"Dataset\",values = hue_pal()(2),labels=c(\"Inflammatory mediators\", \"Tooth microbiome\")) +   theme(legend.position=\"top\", text=element_text(size=16)) # Component 1 - gender, age, symptoms ## Cytokines topIndices = processedCytokines_case$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[2]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedCytokines_case$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[2]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(acmtf_model$Fac[[1]][,1], acmtf_model$Fac[[2]][,1], acmtf_model$Fac[[3]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],2], as.numeric(as.factor(processedCytokines_case$mode1$PainS_NopainA)), use=\"pairwise.complete.obs\")) # flip #> [1] -0.657178 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6],2], as.numeric(as.factor(processedCytokines_case$mode1$PainS_NopainA)), use=\"pairwise.complete.obs\")) #> [1] 0.657178  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],2], processedCytokines_case$mode1 %>% left_join(ageInfo) %>% select(Age) %>% pull(), use=\"pairwise.complete.obs\")) # no flip #> Joining with `by = join_by(SubjectID)` #> [1] 0.5267383 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6],2], processedCytokines_case$mode1 %>% left_join(ageInfo) %>% select(Age) %>% pull(), use=\"pairwise.complete.obs\")) #> Joining with `by = join_by(SubjectID)` #> [1] -0.5267383  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],2], as.numeric(as.factor(processedCytokines_case$mode1$Gender)), use=\"pairwise.complete.obs\")) # flip #> [1] -0.3425585 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6],2], as.numeric(as.factor(processedCytokines_case$mode1$Gender)), use=\"pairwise.complete.obs\")) #> [1] 0.3425585  ## Microbiome topIndices = processedMicrobiome$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[4]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedMicrobiome$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[4]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = CMTFtoolbox::reinflateMatrix(acmtf_model$Fac[[1]][,1], acmtf_model$Fac[[4]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1]], as.numeric(as.factor(processedCytokines_case$mode1$PainS_NopainA)), use=\"pairwise.complete.obs\")) # flip #> [1] -0.657178 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6]], as.numeric(as.factor(processedCytokines_case$mode1$PainS_NopainA)), use=\"pairwise.complete.obs\")) #> [1] 0.657178  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1]], processedCytokines_case$mode1 %>% left_join(ageInfo) %>% select(Age) %>% pull(), use=\"pairwise.complete.obs\")) # no flip #> Joining with `by = join_by(SubjectID)` #> [1] 0.5267383 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6]], processedCytokines_case$mode1 %>% left_join(ageInfo) %>% select(Age) %>% pull(), use=\"pairwise.complete.obs\")) #> Joining with `by = join_by(SubjectID)` #> [1] -0.5267383  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1]], as.numeric(as.factor(processedCytokines_case$mode1$Gender)), use=\"pairwise.complete.obs\")) # flip #> [1] -0.3425585 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6]], as.numeric(as.factor(processedCytokines_case$mode1$Gender)), use=\"pairwise.complete.obs\")) #> [1] 0.3425585  # Component 2 - age only  ## Cytokines topIndices = processedCytokines_case$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[2]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedCytokines_case$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[2]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(acmtf_model$Fac[[1]][,2], acmtf_model$Fac[[2]][,2], acmtf_model$Fac[[3]][,2])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],2], processedCytokines_case$mode1 %>% left_join(ageInfo) %>% select(Age) %>% pull(), use=\"pairwise.complete.obs\")) # flip #> Joining with `by = join_by(SubjectID)` #> [1] -0.6184676 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6],2], processedCytokines_case$mode1 %>% left_join(ageInfo) %>% select(Age) %>% pull(), use=\"pairwise.complete.obs\")) #> Joining with `by = join_by(SubjectID)` #> [1] 0.6184676  ## Microbiome topIndices = processedMicrobiome$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[4]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedMicrobiome$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[4]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = CMTFtoolbox::reinflateMatrix(acmtf_model$Fac[[1]][,2], acmtf_model$Fac[[4]][,2])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1]], processedCytokines_case$mode1 %>% left_join(ageInfo) %>% select(Age) %>% pull(), use=\"pairwise.complete.obs\")) # flip #> Joining with `by = join_by(SubjectID)` #> [1] -0.6184676 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6]], processedCytokines_case$mode1 %>% left_join(ageInfo) %>% select(Age) %>% pull(), use=\"pairwise.complete.obs\")) #> Joining with `by = join_by(SubjectID)` #> [1] 0.6184676 a = processedCytokines_case$mode1 %>%   mutate(Comp1 = acmtf_model$Fac[[1]][,1]) %>%   ggplot(aes(x=as.factor(PainS_NopainA),y=Comp1)) +   geom_boxplot() +   geom_jitter(height=0, width=0.05) +   stat_compare_means(comparisons=list(c(\"A\", \"S\")),label=\"p.signif\") +   xlab(\"\") +   ylab(\"Loading\") +   scale_x_discrete(labels=c(\"Asymptomatic\", \"Symptomatic\")) +   theme(text=element_text(size=16))  temp = processedCytokines_case$mode2 %>%   as_tibble() %>%   mutate(Component_1 = -1*acmtf_model$Fac[[2]][,1]) %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.))  b=temp %>%   ggplot(aes(x=as.factor(index),y=Component_1)) +   geom_bar(stat=\"identity\",col=\"black\") +   scale_x_discrete(label=temp$name) +   xlab(\"\") +   ylab(\"Loading\") +   scale_x_discrete(labels=c(\"OPG\", \"IL-4\", \"IL-6\", expression(IL-1*beta), \"IL-10\", \"IL-12p70\", \"VEGF\", expression(IL-1*alpha), \"IL-17A\", \"IL-8\", expression(IFN-gamma), \"GM-CSF\", expression(TNF-alpha), \"CRP\", expression(MIP-1*alpha), \"RANKL\")) +   theme(text=element_text(size=16),axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) #> Scale for x is already present. #> Adding another scale for x, which will replace the existing scale.  c=acmtf_model$Fac[[3]][,1] %>%   as_tibble() %>%   mutate(value=value) %>%   mutate(timepoint=c(-6,-3,0,1,6,13)) %>%   ggplot(aes(x=timepoint,y=value)) +   geom_line() +   geom_point() +   xlab(\"Time point [weeks]\") +   ylab(\"Loading\") +   ylim(0,1) +   theme(text=element_text(size=16))  temp = processedMicrobiome$mode2 %>%   mutate(comp=-1*acmtf_model$Fac[[4]][,1]) %>%    mutate(Phylum = as.factor(str_split_fixed(Phylum, \"__\", 2)[,2]),          Genus = str_split_fixed(Genus,\"g__\",2)[,2],          Species = str_split_fixed(Species,\"s__\",2)[,2]) %>%   arrange(comp) %>%   mutate(index=1:nrow(.)) %>%   filter(index %in% c(1:10, 143:152))   temp[temp$Species == \"\",\"Species\"] = \"sp.\" temp[grepl(\"taxon\", temp$Species), \"Species\"] = \"sp.\" temp$name = paste0(temp$Genus, \" \", temp$Species) temp[temp$name == \" sp.\",\"name\"] = \"Unknown\"  d = temp %>%   ggplot(aes(x=comp,y=as.factor(index),fill=Phylum)) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=temp$name) +   xlab(\"Loading\") +    ylab(\"\") +   scale_fill_manual(name=\"Phylum\", labels=c(\"Actinobacteria\", \"Firmicutes\", \"Fusobacteria\"), values=hue_pal()(6)[c(1,3,4)]) +   theme(legend.position=\"none\", text=element_text(size=10), axis.text.y=element_text(size=10,face=\"italic\"))  a b c d a = processedCytokines_case$mode1 %>%   left_join(ageInfo) %>%   mutate(Comp1 = acmtf_model$Fac[[1]][,2]) %>%   ggplot(aes(x=Age,y=Comp1)) +   geom_point() +   stat_cor() +   xlab(\"Age\") +   ylab(\"Loading\") +   theme(text=element_text(size=16)) #> Joining with `by = join_by(SubjectID)`  temp = processedCytokines_case$mode2 %>%   as_tibble() %>%   mutate(Component_1 = -1*acmtf_model$Fac[[2]][,2]) %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.))  b=temp %>%   ggplot(aes(x=as.factor(index),y=Component_1)) +   geom_bar(stat=\"identity\",col=\"black\") +   scale_x_discrete(label=temp$name) +   xlab(\"\") +   ylab(\"Loading\") +   scale_x_discrete(labels=c(\"RANKL\", \"IL-10\", \"IL-6\", \"IL-12p70\", \"GM-CSF\", \"IL-17A\", \"IL-4\", expression(IL-1*beta), expression(IFN-gamma), expression(IL-1*alpha), \"OPG\", expression(TNF-alpha), \"CRP\", \"VEGF\", expression(MIP-1*alpha), \"IL-8\" )) +   theme(text=element_text(size=16),axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) #> Scale for x is already present. #> Adding another scale for x, which will replace the existing scale.  c=acmtf_model$Fac[[3]][,2] %>%   as_tibble() %>%   mutate(value=value) %>%   mutate(timepoint=c(-6,-3,0,1,6,13)) %>%   ggplot(aes(x=timepoint,y=value)) +   geom_line() +   geom_point() +   xlab(\"Time point [weeks]\") +   ylab(\"Loading\") +   ylim(0,1) +   theme(text=element_text(size=16))  temp = processedMicrobiome$mode2 %>%   mutate(comp=-1*acmtf_model$Fac[[4]][,2]) %>%    mutate(Phylum = as.factor(str_split_fixed(Phylum, \"__\", 2)[,2]),          Genus = str_split_fixed(Genus,\"g__\",2)[,2],          Species = str_split_fixed(Species,\"s__\",2)[,2]) %>%   arrange(comp) %>%   mutate(index=1:nrow(.)) %>%   filter(index %in% c(1:10, 143:152))   temp[temp$Species == \"\",\"Species\"] = \"sp.\" temp[grepl(\"taxon\", temp$Species), \"Species\"] = \"sp.\" temp$name = paste0(temp$Genus, \" \", temp$Species) temp[temp$name == \" sp.\",\"name\"] = \"Unknown\"  d = temp %>%   ggplot(aes(x=comp,y=as.factor(index),fill=Phylum)) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=temp$name) +   xlab(\"Loading\") +    ylab(\"\") +   theme(legend.position=\"none\", text=element_text(size=16))  a b c d"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/AP.html","id":"processing-1","dir":"Articles","previous_headings":"ACMTF-R","what":"Processing","title":"AP","text":"","code":"# Microbiome processedMicrobiome_acmtf = CMTFtoolbox::Georgiou2025$Tooth_microbiome  # Remove samples due to low library size mask = rowSums(processedMicrobiome_acmtf$data) > 6500 processedMicrobiome_acmtf$data = processedMicrobiome_acmtf$data[mask,] processedMicrobiome_acmtf$mode1 = processedMicrobiome_acmtf$mode1[mask,]  # Remove duplicate samples mask = !(processedMicrobiome_acmtf$mode1$SampleID %in% c(\"A11-8 36\", \"A11-10 17\", \"A11-15 17\")) processedMicrobiome_acmtf$data = processedMicrobiome_acmtf$data[mask,] processedMicrobiome_acmtf$mode1 = processedMicrobiome_acmtf$mode1[mask,]  # Also remove subject A11-8 due to being an outlier processedMicrobiome_acmtf$data = processedMicrobiome_acmtf$data[-23,,] processedMicrobiome_acmtf$mode1 = processedMicrobiome_acmtf$mode1[-23,]  # CLR transformation df = processedMicrobiome_acmtf$data + 1 geomeans = pracma::geomean(as.matrix(df), dim=2) df_clr = log(sweep(df, 1, geomeans, FUN=\"/\"))  # Feature filtering sparsityThreshold = 0.5 maskA = processedMicrobiome_acmtf$mode1$PainS_NopainA == \"A\" maskS = processedMicrobiome_acmtf$mode1$PainS_NopainA == \"S\"  dfA = processedMicrobiome_acmtf$data[maskA,] dfS = processedMicrobiome_acmtf$data[maskS,]  sparsityA = colSums(dfA == 0) / nrow(dfA) sparsityS = colSums(dfS == 0) / nrow(dfS)  mask = (sparsityA <= sparsityThreshold) | (sparsityS <= sparsityThreshold)  processedMicrobiome_acmtf$data = df_clr[,mask] processedMicrobiome_acmtf$mode2 = processedMicrobiome_acmtf$mode2[mask,]  # Center and scale processedMicrobiome_acmtf$data = sweep(processedMicrobiome_acmtf$data, 2, colMeans(processedMicrobiome_acmtf$data), FUN=\"-\") processedMicrobiome_acmtf$data = sweep(processedMicrobiome_acmtf$data, 2, apply(processedMicrobiome_acmtf$data, 2, sd), FUN=\"/\")  # Cytokines processedCytokines_acmtf = CMTFtoolbox::Georgiou2025$Inflammatory_mediators  # Select only case subjects mask = processedCytokines_acmtf$mode1$case_control == \"case\" processedCytokines_acmtf$data = processedCytokines_acmtf$data[mask,,] processedCytokines_acmtf$mode1 = processedCytokines_acmtf$mode1[mask,]  # Select only samples with corresponding microbiome data mask = processedCytokines_acmtf$mode1$SubjectID %in% processedMicrobiome_acmtf$mode1$SubjectID processedCytokines_acmtf$data = processedCytokines_acmtf$data[mask,,] processedCytokines_acmtf$mode1 = processedCytokines_acmtf$mode1[mask,]  processedCytokines_acmtf$data = log(processedCytokines_acmtf$data + 0.005) processedCytokines_acmtf$data = multiwayCenter(processedCytokines_acmtf$data, 1) processedCytokines_acmtf$data = multiwayScale(processedCytokines_acmtf$data, 2) Y = as.numeric(as.factor(processedCytokines_case$mode1$PainS_NopainA)) Ycnt = Y - mean(Y) Ynorm = Ycnt / norm(Ycnt, \"2\") Ynorm = as.matrix(Ynorm)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/AP.html","id":"model-selection-1","dir":"Articles","previous_headings":"ACMTF-R","what":"Model selection","title":"AP","text":"","code":"# Please see the separate R scripts at https://doi.org/10.5281/zenodo.16993009 for the model selection. acmtfr_model90 = readRDS(\"./AP/AP_ACMTFR_model_90.RDS\") testMetadata(acmtfr_model90, 1, processedCytokines_acmtf) #>             Term   Estimate                                          CI #> 1         Gender  98.159830      0.0135392537532894 – 0.182780405453039 #> 2            Age  -2.467714 -0.00533387362284289 – 0.000398444801317704 #> 3 PainS_NopainAS 348.687033       0.263240754458483 – 0.434133311238564 #>        P_value     P_adjust #> 1 2.529062e-02 3.793593e-02 #> 2 8.742526e-02 8.742526e-02 #> 3 6.254957e-08 1.876487e-07 lambda = abs(acmtfr_model90$Fac[[5]]) colnames(lambda) = paste0(\"C\", 1)  lambda %>%   as_tibble() %>%   mutate(block=c(\"cytokines\", \"microbiome\")) %>%   mutate(block=factor(block, levels=c(\"cytokines\", \"microbiome\"))) %>%   pivot_longer(-block) %>%   ggplot(aes(x=as.factor(name),y=value,fill=as.factor(block))) +   geom_bar(stat=\"identity\",position=position_dodge(),col=\"black\") +   xlab(\"ACMTF-R component number\") +   ylab(expression(lambda)) +   scale_x_discrete(labels=1:3) +   scale_fill_manual(name=\"Dataset\",values = hue_pal()(2),labels=c(\"Inflammatory mediators\", \"Tooth microbiome\")) +   theme(legend.position=\"top\", text=element_text(size=16)) # Cytokines topIndices = processedCytokines_case$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[2]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedCytokines_case$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[2]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(acmtfr_model90$Fac[[1]][,1], acmtfr_model90$Fac[[2]][,1], acmtfr_model90$Fac[[3]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],2], as.numeric(as.factor(processedCytokines_case$mode1$PainS_NopainA)), use=\"pairwise.complete.obs\")) # flip #> [1] -0.8591682 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6],2], as.numeric(as.factor(processedCytokines_case$mode1$PainS_NopainA)), use=\"pairwise.complete.obs\")) #> [1] 0.8591682  # Microbiome topIndices = processedMicrobiome$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[4]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedMicrobiome$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[4]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = CMTFtoolbox::reinflateMatrix(acmtfr_model90$Fac[[1]][,1], acmtfr_model90$Fac[[4]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1]], as.numeric(as.factor(processedCytokines_case$mode1$PainS_NopainA)), use=\"pairwise.complete.obs\")) # no flip #> [1] 0.8591682 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1]], as.numeric(as.factor(processedCytokines_case$mode1$PainS_NopainA)), use=\"pairwise.complete.obs\")) #> [1] -0.8591682 # Subject mode a = processedCytokines_case$mode1 %>%   mutate(Comp1 = acmtfr_model90$Fac[[1]][,1]) %>%   ggplot(aes(x=as.factor(PainS_NopainA),y=Comp1)) +   geom_boxplot() +   geom_jitter(height=0, width=0.05) +   stat_compare_means(comparisons=list(c(\"A\", \"S\")),label=\"p.signif\") +   xlab(\"\") +   ylab(\"Loading\") +   scale_x_discrete(labels=c(\"Asymptomatic\", \"Symptomatic\")) +   theme(text=element_text(size=16))  ## Cytokines temp = processedCytokines_case$mode2 %>%   as_tibble() %>%   mutate(Component_1 = -1*acmtfr_model90$Fac[[2]][,1]) %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.))  b=temp %>%   ggplot(aes(x=as.factor(index),y=Component_1)) +   geom_bar(stat=\"identity\",col=\"black\") +   scale_x_discrete(label=temp$name) +   xlab(\"\") +   ylab(\"Loading\") +   scale_x_discrete(labels=c(\"OPG\", \"IL-4\", \"IL-6\", expression(IL-1*beta), \"IL-10\", \"IL-12p70\", \"VEGF\", expression(IFN-gamma), \"IL-17A\", \"GM-CSF\", expression(IL-1*alpha), \"IL-8\", \"CRP\", expression(TNF-alpha), expression(MIP-1*alpha), \"RANKL\")) +   theme(text=element_text(size=16),axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) #> Scale for x is already present. #> Adding another scale for x, which will replace the existing scale.  # Microbiome temp = processedMicrobiome$mode2 %>%   mutate(comp=acmtfr_model90$Fac[[4]][,1]) %>%    mutate(Phylum = as.factor(str_split_fixed(Phylum, \"__\", 2)[,2]),          Genus = str_split_fixed(Genus,\"g__\",2)[,2],          Species = str_split_fixed(Species,\"s__\",2)[,2]) %>%   arrange(comp) %>%   mutate(index=1:nrow(.)) %>%   filter(index %in% c(1:10, 143:152))   temp[temp$Species == \"\",\"Species\"] = \"sp.\" temp[grepl(\"taxon\", temp$Species), \"Species\"] = \"sp.\" temp$name = paste0(temp$Genus, \" \", temp$Species) temp[temp$name == \" sp.\",\"name\"] = \"Unknown\"  c = temp %>%   ggplot(aes(x=comp,y=as.factor(index),fill=Phylum)) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=temp$name) +   xlab(\"Loading\") +    ylab(\"\") +   scale_fill_manual(name=\"Phylum\", labels=c(\"Actinobacteria\", \"Firmicutes\", \"Fusobacteria\"), values=hue_pal()(6)[c(1,3,4)]) +   theme(legend.position=\"none\", text=element_text(size=16))  d = acmtfr_model90$Fac[[3]][,1] %>%   as_tibble() %>%   mutate(value=-1*value) %>%   mutate(timepoint=c(-6,-3,0,1,6,13)) %>%   ggplot(aes(x=timepoint,y=value)) +   geom_line() +   geom_point() +   xlab(\"Time point [weeks]\") +   ylab(\"Loading\") +   ylim(0,1) +   theme(text=element_text(size=16))  a b c d"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/GOHTRANS.html","id":"preamble","dir":"Articles","previous_headings":"","what":"Preamble","title":"GOHTRANS","text":"","code":"library(dplyr) #>  #> Attaching package: 'dplyr' #> The following objects are masked from 'package:stats': #>  #>     filter, lag #> The following objects are masked from 'package:base': #>  #>     intersect, setdiff, setequal, union library(tidyr) library(parafac4microbiome) library(NPLStoolbox) library(CMTFtoolbox) #>  #> Attaching package: 'CMTFtoolbox' #> The following object is masked from 'package:NPLStoolbox': #>  #>     npred #> The following objects are masked from 'package:parafac4microbiome': #>  #>     fac_to_vect, reinflateFac, reinflateTensor, vect_to_fac library(ggplot2) library(ggpubr) library(readr) library(stringr) library(scales) #>  #> Attaching package: 'scales' #> The following object is masked from 'package:readr': #>  #>     col_factor ph_BOMP = read_delim(\"./GOHTRANS/GOH-TRANS_export_20240205.csv\",                      delim = \";\", escape_double = FALSE, trim_ws = TRUE) %>% as_tibble() #> Rows: 42 Columns: 347 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \";\" #> chr (104): Participant Status, Site Abbreviation, Participant Creation Date,... #> dbl (243): Participant Id, pat_genderID, Age, Informed_consent#Yes, Informed... #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.  df1 = ph_BOMP %>% select(`Participant Id`, starts_with(\"5.\")) %>% mutate(subject = 1:42, numTeeth = `5.1|Number of teeth`, DMFT = `5.2|DMFT`, numBleedingSites = `5.3|Bleeding sites`, boppercent = `5.4|BOP%`, DPSI = `5.5|DPSI`, pH = `5.8|pH`) %>% select(subject, numTeeth, DMFT, numBleedingSites, boppercent, DPSI, pH) df2 = ph_BOMP %>% select(`Participant Id`, starts_with(\"12.\")) %>% mutate(subject = 1:42, numTeeth = `12.1|Number of teeth`, DMFT = `12.2|DMFT`, numBleedingSites = `12.3|Bleeding sites`, boppercent = `12.4|BOP%`, DPSI = `12.5|DPSI`, pH = `12.8|pH`) %>% select(subject, numTeeth, DMFT, numBleedingSites, boppercent, DPSI, pH) df3 = ph_BOMP %>% select(`Participant Id`, starts_with(\"19.\")) %>% mutate(subject = 1:42, numTeeth = `19.1|Number of teeth`, DMFT = `19.2|DMFT`, numBleedingSites = `19.3|Bleeding sites`, boppercent = `19.4|BOP%`, DPSI = `19.5|DPSI`, pH = `19.8|pH`) %>% select(subject, numTeeth, DMFT, numBleedingSites, boppercent, DPSI, pH) df4 = ph_BOMP %>% select(`Participant Id`, starts_with(\"26.\")) %>% mutate(subject = 1:42, numTeeth = `26.1|Number of teeth`, DMFT = `26.2|DMFT`, numBleedingSites = `26.3|Bleeding sites`, boppercent = `26.4|BOP%`, DPSI = `26.5|DPSI`, pH = `26.8|pH`) %>% select(subject, numTeeth, DMFT, numBleedingSites, boppercent, DPSI, pH)  otherMeta = rbind(df1, df2, df3, df4) %>% as_tibble() %>% mutate(newTimepoint = rep(c(0,3,6,12), each=42)) otherMeta = otherMeta %>% select(subject, newTimepoint, boppercent) otherMeta[otherMeta$boppercent < 0 & !is.na(otherMeta$boppercent), \"boppercent\"] = NA  saliva_sampleMeta = read.csv(\"./GOHTRANS/sampleInfo_fixed.csv\", sep=\" \") %>% as_tibble() %>% select(subject, GenderID, Age, newTimepoint)  # CODS XI df = read.csv(\"./GOHTRANS/CODS_XI.csv\") df = df[1:40,1:10] %>% as_tibble() %>% filter(Participant_code %in% saliva_sampleMeta$subject)  CODS = df %>% select(Participant_code, CODS_BASELINE, CODS_3_MONTHS, CODS_6_MONTHS, CODS_12_MONTHS) %>% pivot_longer(-Participant_code) %>% mutate(timepoint = NA) CODS[CODS$name == \"CODS_BASELINE\", \"timepoint\"] = 0 CODS[CODS$name == \"CODS_3_MONTHS\", \"timepoint\"] = 3 CODS[CODS$name == \"CODS_6_MONTHS\", \"timepoint\"] = 6 CODS[CODS$name == \"CODS_12_MONTHS\", \"timepoint\"] = 12 CODS[CODS$value == -99, \"value\"] = NA CODS = CODS %>% mutate(subject = Participant_code, newTimepoint = timepoint, CODS = value) %>% select(-Participant_code, -name, -value, -timepoint)  XI = df %>% select(Participant_code, XI_BASELINE, XI_3_MONTHS, XI_6_MONTHS, XI_12_MONTHS) %>% pivot_longer(-Participant_code) %>% mutate(timepoint = NA) XI[XI$name == \"XI_BASELINE\", \"timepoint\"] = 0 XI[XI$name == \"XI_3_MONTHS\", \"timepoint\"] = 3 XI[XI$name == \"XI_6_MONTHS\", \"timepoint\"] = 6 XI[XI$name == \"XI_12_MONTHS\", \"timepoint\"] = 12 XI[XI$value == -99, \"value\"] = NA XI = XI %>% mutate(subject = Participant_code, newTimepoint = timepoint, XI = value) %>% select(-Participant_code, -name, -value, -timepoint)  df = otherMeta %>% left_join(CODS) %>% left_join(XI) %>% select(subject, newTimepoint, boppercent, CODS, XI) %>% filter(newTimepoint != \"NA\") #> Joining with `by = join_by(subject, newTimepoint)` #> Joining with `by = join_by(subject, newTimepoint)`  meta = df %>% left_join(otherMeta) %>% left_join(saliva_sampleMeta) %>% filter(newTimepoint==12) %>% unique() %>% select(-newTimepoint) #> Joining with `by = join_by(subject, newTimepoint, boppercent)` #> Joining with `by = join_by(subject, newTimepoint)` meta[meta < 0] <- NA  newBOP = residuals(lm(boppercent ~ GenderID + Age + CODS + XI, data=meta, na.action=na.exclude)) newCODS= residuals(lm(CODS ~ boppercent + GenderID + Age + XI, data=meta, na.action=na.exclude)) newXI = residuals(lm(XI ~ boppercent + GenderID + Age + CODS, data=meta, na.action=na.exclude))  meta = meta %>% mutate(boppercent = newBOP, CODS = newCODS, XI = newXI) prepMetadata = function(model, metadata){   longA = parafac4microbiome::transformPARAFACloadings(model$Fac, 2, moreOutput = TRUE)$F   df = longA %>% as_tibble() %>% mutate(subject=as.integer(rep(metadata$mode1$subject, each=nrow(metadata$mode3))), newTimepoint = rep(metadata$mode3$newTimepoint, nrow(metadata$mode1))) %>% left_join(Cornejo2025$Blood_hormones) %>% left_join(Cornejo2025$Clinical_measurements)      newTesto = residuals(lm(Free_testosterone_Vermeulen_pmol_L ~ Estradiol_pmol_ml + LH_U_L + SHBG_nmol_L + boppercent + pH + GenderID + Age, data=df, na.action=na.exclude))   newEstra = residuals(lm(Estradiol_pmol_ml ~ Free_testosterone_Vermeulen_pmol_L + LH_U_L + SHBG_nmol_L + boppercent + pH + GenderID + Age, data=df, na.action=na.exclude))   newLH = residuals(lm(LH_U_L ~ Free_testosterone_Vermeulen_pmol_L + Estradiol_pmol_ml + SHBG_nmol_L + boppercent + pH + GenderID + Age, data=df, na.action=na.exclude))   newSHBG = residuals(lm(SHBG_nmol_L ~ Free_testosterone_Vermeulen_pmol_L + Estradiol_pmol_ml + LH_U_L + boppercent + pH + GenderID + Age, data=df, na.action=na.exclude))   newBOP = residuals(lm(boppercent ~ Free_testosterone_Vermeulen_pmol_L + Estradiol_pmol_ml + LH_U_L + SHBG_nmol_L + pH + GenderID + Age, data=df, na.action=na.exclude))   newPH = residuals(lm(pH ~ Free_testosterone_Vermeulen_pmol_L + Estradiol_pmol_ml + LH_U_L + SHBG_nmol_L + boppercent + GenderID + Age, data=df, na.action=na.exclude))      df$Free_testosterone_Vermeulen_pmol_L = newTesto   df$Estradiol_pmol_ml = newEstra   df$LH_U_L = newLH   df$SHBG_nmol_L = newSHBG   df$boppercent = newBOP   df$pH = newPH   df$GenderID = as.numeric(as.factor(df$GenderID))      return(df) }  clinical_metadata = NPLStoolbox::Cornejo2025$Clinical_measurements$mode1 %>% mutate(BOP = NPLStoolbox::Cornejo2025$Clinical_measurements$data[,1,2], CODS = NPLStoolbox::Cornejo2025$Clinical_measurements$data[,2,2], XI = NPLStoolbox::Cornejo2025$Clinical_measurements$data[,3,2]) %>% left_join(NPLStoolbox::Cornejo2025$Subject_metadata %>% mutate(subject = as.character(subject))) #> Joining with `by = join_by(subject, GenderID)`  testMetadata = function(model, comp, metadata){   transformedSubjectLoadings = model$Fac[[1]][,comp]   transformedSubjectLoadings = transformedSubjectLoadings / norm(transformedSubjectLoadings, \"2\")      metadata = metadata$mode1 %>% left_join(clinical_metadata) %>% mutate(GenderID = as.numeric(as.factor(GenderID))-1)      result = lm(transformedSubjectLoadings ~ GenderID + Age + BOP + CODS + XI, data=metadata)      # Extract coefficients and confidence intervals   coef_estimates <- summary(result)$coefficients   conf_intervals <- confint(result)      # Remove intercept   coef_estimates <- coef_estimates[rownames(coef_estimates) != \"(Intercept)\", ]   conf_intervals <- conf_intervals[rownames(conf_intervals) != \"(Intercept)\", ]      # Combine into a clean data frame   summary_table <- data.frame(     Term     = rownames(coef_estimates),     Estimate = coef_estimates[, \"Estimate\"] * 1e3,     CI       = paste0(                  conf_intervals[, 1], \" – \",                  conf_intervals[, 2]                ),     P_value  = coef_estimates[, \"Pr(>|t|)\"],     P_adjust = p.adjust(coef_estimates[, \"Pr(>|t|)\"], \"BH\"),     row.names = NULL   )      return(summary_table) } processedTongue = processDataCube(NPLStoolbox::Cornejo2025$Tongue_microbiome, sparsityThreshold = 0.5, considerGroups=TRUE, groupVariable=\"GenderID\", CLR=TRUE, centerMode=1, scaleMode=2) processedSaliva = processDataCube(NPLStoolbox::Cornejo2025$Salivary_microbiome, sparsityThreshold = 0.5, considerGroups=TRUE, groupVariable=\"GenderID\", CLR=TRUE, centerMode=1, scaleMode=2)  processedCytokines = NPLStoolbox::Cornejo2025$Salivary_cytokines processedCytokines$data = log(processedCytokines$data + 0.1300) # Remove subject 1, 18, 19, and 27 due to being an outlier processedCytokines$data = processedCytokines$data[-c(1,9,10,19),,] processedCytokines$mode1 = processedCytokines$mode1[-c(1,9,10,19),] processedCytokines$data = multiwayCenter(processedCytokines$data, 1) processedCytokines$data = multiwayScale(processedCytokines$data, 2)  processedBiochemistry = NPLStoolbox::Cornejo2025$Salivary_biochemistry processedBiochemistry$data = log(processedBiochemistry$data) processedBiochemistry$data = multiwayCenter(processedBiochemistry$data, 1) processedBiochemistry$data = multiwayScale(processedBiochemistry$data, 2)  processedHormones = NPLStoolbox::Cornejo2025$Circulatory_hormones processedHormones$data = log(processedHormones$data) processedHormones$data = multiwayCenter(processedHormones$data, 1) processedHormones$data = multiwayScale(processedHormones$data, 2) deltaT = NPLStoolbox::Cornejo2025$Circulatory_hormones$data[,1,2] - NPLStoolbox::Cornejo2025$Circulatory_hormones$data[,1,1] outcome = processedHormones$mode1 %>% mutate(deltaT = deltaT) %>% filter(deltaT != \"NA\") processedTongue = processDataCube(NPLStoolbox::Cornejo2025$Tongue_microbiome, sparsityThreshold = 0.5, considerGroups=TRUE, groupVariable=\"GenderID\", CLR=TRUE, centerMode=FALSE, scaleMode=FALSE) mask = processedTongue$mode1$subject %in% outcome$subject processedTongue$mode1 = processedTongue$mode1[mask,] processedTongue$data = processedTongue$data[mask,,] processedTongue$data = multiwayCenter(processedTongue$data, 1) processedTongue$data = multiwayScale(processedTongue$data, 2)  processedSaliva = processDataCube(NPLStoolbox::Cornejo2025$Salivary_microbiome, sparsityThreshold = 0.5, considerGroups=TRUE, groupVariable=\"GenderID\", CLR=TRUE, centerMode=1, scaleMode=2) mask = processedSaliva$mode1$subject %in% outcome$subject processedSaliva$mode1 = processedSaliva$mode1[mask,] processedSaliva$data = processedSaliva$data[mask,,] processedSaliva$data = multiwayCenter(processedSaliva$data, 1) processedSaliva$data = multiwayScale(processedSaliva$data, 2)  processedCytokines = NPLStoolbox::Cornejo2025$Salivary_cytokines processedCytokines$data = log(processedCytokines$data + 0.1300) # Remove subject 1, 18, 19, and 27 due to being an outlier processedCytokines$data = processedCytokines$data[-c(1,9,10,19),,] processedCytokines$mode1 = processedCytokines$mode1[-c(1,9,10,19),] mask = processedCytokines$mode1$subject %in% outcome$subject processedCytokines$mode1 = processedCytokines$mode1[mask,] processedCytokines$data = processedCytokines$data[mask,,] processedCytokines$data = multiwayCenter(processedCytokines$data, 1) processedCytokines$data = multiwayScale(processedCytokines$data, 2)  processedBiochemistry = NPLStoolbox::Cornejo2025$Salivary_biochemistry processedBiochemistry$data = log(processedBiochemistry$data) mask = processedBiochemistry$mode1$subject %in% outcome$subject processedBiochemistry$mode1 = processedBiochemistry$mode1[mask,] processedBiochemistry$data = processedBiochemistry$data[mask,,] processedBiochemistry$data = multiwayCenter(processedBiochemistry$data, 1) processedBiochemistry$data = multiwayScale(processedBiochemistry$data, 2) Y = processedTongue$mode1 %>% left_join(outcome) %>% select(deltaT) %>% pull() #> Joining with `by = join_by(subject, GenderID)` Ycnt = Y - mean(Y) Ynorm_tongue = Ycnt / norm(Ycnt, \"2\")  Y = processedSaliva$mode1 %>% left_join(outcome) %>% select(deltaT) %>% pull() #> Joining with `by = join_by(subject, GenderID)` Ycnt = Y - mean(Y) Ynorm_saliva = Ycnt / norm(Ycnt, \"2\")  Y = processedCytokines$mode1 %>% left_join(outcome) %>% select(deltaT) %>% pull() #> Joining with `by = join_by(subject, GenderID)` Ycnt = Y - mean(Y) Ynorm_cytokine = Ycnt / norm(Ycnt, \"2\")  Y = processedBiochemistry$mode1 %>% left_join(outcome) %>% select(deltaT) %>% pull() #> Joining with `by = join_by(subject, GenderID)` Ycnt = Y - mean(Y) Ynorm_biochem = Ycnt / norm(Ycnt, \"2\")"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/GOHTRANS.html","id":"processing","dir":"Articles","previous_headings":"ACMTF","what":"Processing","title":"GOHTRANS","text":"","code":"deltaT = NPLStoolbox::Cornejo2025$Circulatory_hormones$data[,1,2] - NPLStoolbox::Cornejo2025$Circulatory_hormones$data[,1,1] outcome = NPLStoolbox::Cornejo2025$Circulatory_hormones$mode1 %>% mutate(deltaT = deltaT) %>% filter(deltaT != \"NA\")  homogenizedSamples1 = intersect(NPLStoolbox::Cornejo2025$Tongue_microbiome$mode1$subject, outcome$subject) homogenizedSamples2 = intersect(NPLStoolbox::Cornejo2025$Salivary_microbiome$mode1$subject, outcome$subject) homogenizedSamples3 = intersect(NPLStoolbox::Cornejo2025$Salivary_cytokines$mode1$subject, outcome$subject) homogenizedSamples4 = intersect(NPLStoolbox::Cornejo2025$Salivary_biochemistry$mode1$subject, outcome$subject)  homogenizedSamples = intersect(intersect(homogenizedSamples1, homogenizedSamples2), intersect(homogenizedSamples3,homogenizedSamples4))  outcome = outcome %>% filter(subject %in% homogenizedSamples)  # Tongue newTongue = NPLStoolbox::Cornejo2025$Tongue  mask = newTongue$mode1$subject %in% homogenizedSamples newTongue$data = newTongue$data[mask,,] newTongue$mode1 = newTongue$mode1[mask,]  processedTongue_acmtf = processDataCube(newTongue, sparsityThreshold = 0.5, considerGroups=TRUE, groupVariable=\"GenderID\", CLR=TRUE, centerMode=1, scaleMode=2)  # Saliva newSaliva = NPLStoolbox::Cornejo2025$Salivary_microbiome  mask = newSaliva$mode1$subject %in% homogenizedSamples newSaliva$data = newSaliva$data[mask,,] newSaliva$mode1 = newSaliva$mode1[mask,]  processedSaliva_acmtf = processDataCube(newSaliva, sparsityThreshold = 0.5, considerGroups=TRUE, groupVariable=\"GenderID\", CLR=TRUE, centerMode=1, scaleMode=2)  # Cytokines newCytokines = NPLStoolbox::Cornejo2025$Salivary_cytokines  mask = newCytokines$mode1$subject %in% homogenizedSamples newCytokines$data = log(newCytokines$data[mask,,] + 0.1300) newCytokines$mode1 = newCytokines$mode1[mask,]  processedCytokines_acmtf = processDataCube(newCytokines, CLR=FALSE, centerMode=1, scaleMode=2)  # Biochemistry newBio = NPLStoolbox::Cornejo2025$Salivary_biochemistry  mask = newBio$mode1$subject %in% homogenizedSamples newBio$data = log(newBio$data[mask,,]) newBio$mode1 = newBio$mode1[mask,]  processedBiochemistry_acmtf = processDataCube(newBio, CLR=FALSE, centerMode=1, scaleMode=2) # Please see the separate R scripts at https://doi.org/10.5281/zenodo.16993009 for the model selection. acmtf_model = readRDS(\"./GOHTRANS/GOHTRANS_ACMTFR_model_1_deltaT.RDS\") testMetadata(acmtf_model, 1, processedTongue_acmtf) #> Joining with `by = join_by(subject, GenderID)` #>       Term      Estimate                                        CI    P_value #> 1 GenderID -101.21791354   -0.290530383376818 – 0.0880945562890892 0.27497424 #> 2      Age   -0.02948517  -0.0209679087018061 – 0.0209089383631103 0.99766407 #> 3      BOP    3.79594066 -0.00978973512676411 – 0.0173816164549634 0.56328018 #> 4     CODS  195.59611322   -0.0171112553246807 – 0.408303481755385 0.06914254 #> 5       XI    4.28194458  -0.0180263793638558 – 0.0265902685172408 0.69055280 #>    P_adjust #> 1 0.6874356 #> 2 0.9976641 #> 3 0.8631910 #> 4 0.3457127 #> 5 0.8631910 testMetadata(acmtf_model, 2, processedTongue_acmtf) #> Joining with `by = join_by(subject, GenderID)` #>       Term    Estimate                                        CI    P_value #> 1 GenderID  226.449388    0.0421578238420423 – 0.410740952272122 0.01897398 #> 2      Age    5.034403    -0.015348696173811 – 0.025417501936632 0.60901796 #> 3      BOP    5.583413 -0.00764194599027333 – 0.0188087727038087 0.38551700 #> 4     CODS -175.966485   -0.383032473273648 – 0.0310995033774118 0.09079355 #> 5       XI   -8.462002  -0.0301786687708441 – 0.0132546657331868 0.42240150 #>     P_adjust #> 1 0.09486989 #> 2 0.60901796 #> 3 0.52800187 #> 4 0.22698387 #> 5 0.52800187 lambda = abs(acmtf_model$Fac[[10]]) colnames(lambda) = paste0(\"C\", 1:2)  lambda %>%   as_tibble() %>%   mutate(block=c(\"tongue\", \"saliva\", \"cytokines\", \"biochemistry\")) %>%   mutate(block=factor(block, levels=c(\"tongue\", \"saliva\", \"cytokines\", \"biochemistry\"))) %>%   pivot_longer(-block) %>%   ggplot(aes(x=as.factor(name),y=value,fill=as.factor(block))) +   geom_bar(stat=\"identity\",position=position_dodge(),col=\"black\") +   xlab(\"ACMTF component number\") +   ylab(expression(lambda)) +   scale_x_discrete(labels=1:3) +   scale_fill_manual(name=\"Dataset\",values = hue_pal()(4),labels=c(\"Tongue\", \"Salivary microbiome\", \"Salivary cytokines\", \"Salivary biochemistry\")) +   theme(legend.position=\"top\") # Briefly check how the signs work  # Tongue topIndices = processedTongue_acmtf$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[2]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedTongue_acmtf$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[2]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(acmtf_model$Fac[[1]][,2], acmtf_model$Fac[[2]][,2], acmtf_model$Fac[[3]][,2])  print(\"Positive loadings:\") # flip #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], as.numeric(as.factor(processedTongue_acmtf$mode1$GenderID)), use=\"pairwise.complete.obs\")) #> [1] -0.3927546 processedTongue_acmtf$mode1 %>% mutate(comp = Xhat[,topIndices[1],1]) %>% ggplot(aes(x=as.factor(GenderID),y=comp)) + geom_boxplot() print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], as.numeric(as.factor(processedTongue_acmtf$mode1$GenderID)), use=\"pairwise.complete.obs\")) #> [1] 0.3927546 processedTongue_acmtf$mode1 %>% mutate(comp = Xhat[,bottomIndices[1],1]) %>% ggplot(aes(x=as.factor(GenderID),y=comp)) + geom_boxplot() # Saliva topIndices = processedSaliva_acmtf$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[4]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedSaliva_acmtf$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[4]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(acmtf_model$Fac[[1]][,2], acmtf_model$Fac[[4]][,2], acmtf_model$Fac[[5]][,2])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], as.numeric(as.factor(processedSaliva_acmtf$mode1$GenderID)), use=\"pairwise.complete.obs\")) #flip #> [1] -0.3927546 processedSaliva_acmtf$mode1 %>% mutate(comp = Xhat[,topIndices[1],1]) %>% ggplot(aes(x=as.factor(GenderID),y=comp)) + geom_boxplot() print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], as.numeric(as.factor(processedSaliva_acmtf$mode1$GenderID)), use=\"pairwise.complete.obs\")) #> [1] 0.3927546 processedSaliva_acmtf$mode1 %>% mutate(comp = Xhat[,bottomIndices[1],1]) %>% ggplot(aes(x=as.factor(GenderID),y=comp)) + geom_boxplot() # Cytokines topIndices = processedCytokines_acmtf$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[6]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedCytokines_acmtf$mode2 %>% mutate(index=1:nrow(.), Comp = acmtf_model$Fac[[6]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = -0.33 * parafac4microbiome::reinflateTensor(acmtf_model$Fac[[1]][,2], acmtf_model$Fac[[6]][,2], acmtf_model$Fac[[7]][,2])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], as.numeric(as.factor(processedCytokines_acmtf$mode1$GenderID)), use=\"pairwise.complete.obs\")) # no flip - all positive and TF associated #> [1] 0.3927546 processedCytokines_acmtf$mode1 %>% mutate(comp = Xhat[,topIndices[1],1]) %>% ggplot(aes(x=as.factor(GenderID),y=comp)) + geom_boxplot() print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[6],1], as.numeric(as.factor(processedCytokines_acmtf$mode1$GenderID)), use=\"pairwise.complete.obs\")) #> [1] -0.3927546 processedCytokines_acmtf$mode1 %>% mutate(comp = Xhat[,bottomIndices[1],1]) %>% ggplot(aes(x=as.factor(GenderID),y=comp)) + geom_boxplot() # Biochemistry topIndices = 1 bottomIndices = 7  Xhat = parafac4microbiome::reinflateTensor(acmtf_model$Fac[[1]][,2], acmtf_model$Fac[[8]][,2], acmtf_model$Fac[[9]][,2])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], as.numeric(as.factor(processedBiochemistry_acmtf$mode1$GenderID)), use=\"pairwise.complete.obs\")) # no flip #> [1] 0.3927546 processedBiochemistry_acmtf$mode1 %>% mutate(comp = Xhat[,topIndices[1],1]) %>% ggplot(aes(x=as.factor(GenderID),y=comp)) + geom_boxplot() print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], as.numeric(as.factor(processedBiochemistry_acmtf$mode1$GenderID)), use=\"pairwise.complete.obs\")) #> [1] -0.3927546 processedBiochemistry_acmtf$mode1 %>% mutate(comp = Xhat[,bottomIndices[1],1]) %>% ggplot(aes(x=as.factor(GenderID),y=comp)) + geom_boxplot() # Tongue temp = processedTongue_acmtf$mode2 %>%   as_tibble() %>%   mutate(Component_1 = -1*acmtf_model$Fac[[2]][,2]) %>%   mutate(Genus = gsub(\"g__\", \"\", Genus), Species = gsub(\"s__\", \"\", Species)) %>%   mutate(Species = gsub(\"\\\\(\", \"\", Species)) %>%   mutate(Species = gsub(\"\\\\)\", \"\", Species))  fixedSpeciesNames = str_split_fixed(temp$Species, \"/\", 5) %>%    as_tibble() %>%   mutate(dplyr::across(.cols = everything(), .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) #> Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if #> `.name_repair` is omitted as of tibble 2.0.0. #> ℹ Using compatibility `.name_repair`. #> This warning is displayed once every 8 hours. #> Call `lifecycle::last_lifecycle_warnings()` to see where this warning was #> generated. fixedSpeciesNames[fixedSpeciesNames$V1 == \"\", \"V1\"] = \"sp.\" fixedSpeciesNames = fixedSpeciesNames %>%    mutate(name=paste0(V1, \"/\", V2)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V3)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V4)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V5)) %>%    mutate(name=gsub(\"/$\", \"\", name))  temp$Species = fixedSpeciesNames$name temp$name = paste0(temp$Genus, \" \", temp$Species) temp[temp$name == \" sp.\", \"name\"] = \"Unclassified\" temp[temp$name == \" \", \"name\"] = \"Unclassified\" temp[temp$name == \" sp.\", \"name\"] = \"Unclassified\"  temp = temp %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.)) %>%   filter(index %in% c(1:10,228:237))  a=temp %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(Phylum))) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=temp$name) +   xlab(\"Loading\") +   ylab(\"\") +   scale_fill_manual(name=\"Phylum\", labels=c(\"Actinobacteria\", \"Bacteroidetes\", \"Firmicutes\"), values=hue_pal()(5)[-c(4,5)]) +   theme(text=element_text(size=16))  # Saliva comp 1 temp = processedSaliva_acmtf$mode2 %>%   as_tibble() %>%   mutate(Component_1 = -1*acmtf_model$Fac[[4]][,2]) %>%   mutate(Genus = gsub(\"g__\", \"\", Genus), Species = gsub(\"s__\", \"\", Species)) %>%   mutate(Species = gsub(\"\\\\(\", \"\", Species)) %>%   mutate(Species = gsub(\"\\\\)\", \"\", Species))  fixedSpeciesNames = str_split_fixed(temp$Species, \"/\", 5) %>%    as_tibble() %>%   mutate(dplyr::across(.cols = everything(), .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) fixedSpeciesNames[fixedSpeciesNames$V1 == \"\", \"V1\"] = \"sp.\" fixedSpeciesNames = fixedSpeciesNames %>%    mutate(name=paste0(V1, \"/\", V2)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V3)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V4)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V5)) %>%    mutate(name=gsub(\"/$\", \"\", name))  temp$Species = fixedSpeciesNames$name temp$name = paste0(temp$Genus, \" \", temp$Species) temp[temp$name == \" sp.\", \"name\"] = \"Unclassified\" temp[temp$name == \" \", \"name\"] = \"Unclassified\" temp[temp$name == \" sp.\", \"name\"] = \"Unclassified\"  temp = temp %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.)) %>%   filter(index %in% c(1:10,260:269))  b=temp %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(Phylum))) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=temp$name) +   xlab(\"Loading\") +   ylab(\"\") +   guides(fill=guide_legend(title=\"Phylum\")) +   theme(text=element_text(size=16))  # Cytokines comp 1 temp = processedCytokines_acmtf$mode2 %>%   mutate(Comp = acmtf_model$Fac[[6]][,2]) %>%   arrange(Comp) %>%   mutate(index=1:nrow(.)) %>%   mutate(V1 = gsub(\"_pg_ml\", \"\", V1)) %>%   mutate(V1 = gsub(\"_\", \"-\", V1))  c = temp %>%   ggplot(aes(x=Comp,y=as.factor(index))) +   geom_bar(stat=\"identity\", col=\"black\") +   xlab(\"Loading\") +   ylab(\"\") +   scale_y_discrete(labels=temp$V1) +   theme(text=element_text(size=16))    # Biochemistry comp 1 temp = processedBiochemistry_acmtf$mode2 %>%   mutate(Comp = acmtf_model$Fac[[8]][,2]) %>%   arrange(Comp) %>%   mutate(index=1:nrow(.)) %>%   mutate(V1 = c(\"pH\", \"Chitinase\", \"S-IgA\", \"Amylase\", \"MUC-5B\", \"Lysozyme\", \"Total protein\"))  d = temp %>%   ggplot(aes(x=Comp,y=as.factor(index))) +   geom_bar(stat=\"identity\", col=\"black\") +   xlab(\"Loading\") +   ylab(\"\") +   scale_y_discrete(labels=temp$V1) +   theme(text=element_text(size=16))  a b c d a = acmtf_model$Fac[[3]][,2] %>% as_tibble() %>% mutate(value=-1*value) %>% mutate(timepoint=c(0,3,6,12)) %>% ggplot(aes(x=timepoint,y=value)) + geom_line() + geom_point() + xlab(\"Time point [months]\") + ylab(\"Loading\") + ylim(0,1)  b = acmtf_model$Fac[[5]][,2] %>% as_tibble() %>% mutate(value=-1*value) %>% mutate(timepoint=c(0,3,6,12)) %>% ggplot(aes(x=timepoint,y=value)) + geom_line() + geom_point() + xlab(\"Time point [months]\") + ylab(\"Loading\") + ylim(0,1)  c = acmtf_model$Fac[[7]][,2] %>% as_tibble() %>% mutate(value=-1*value) %>% mutate(timepoint=c(0,3,12)) %>% ggplot(aes(x=timepoint,y=value)) + geom_line() + geom_point() + xlab(\"Time point [months]\") + ylab(\"Loading\") + ylim(-1,1)  d = acmtf_model$Fac[[9]][,2] %>% as_tibble() %>% mutate(value=value) %>% mutate(timepoint=c(0,3,6,12)) %>% ggplot(aes(x=timepoint,y=value)) + geom_line() + geom_point() + xlab(\"Time point [months]\") + ylab(\"Loading\") + ylim(0,1)  a b c d"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/GOHTRANS.html","id":"processing-1","dir":"Articles","previous_headings":"ACMTF-R","what":"Processing","title":"GOHTRANS","text":"","code":"deltaT = NPLStoolbox::Cornejo2025$Circulatory_hormones$data[,1,2] - NPLStoolbox::Cornejo2025$Circulatory_hormones$data[,1,1] outcome = NPLStoolbox::Cornejo2025$Circulatory_hormones$mode1 %>% mutate(deltaT = deltaT) %>% filter(deltaT != \"NA\")  homogenizedSamples1 = intersect(NPLStoolbox::Cornejo2025$Tongue_microbiome$mode1$subject, outcome$subject) homogenizedSamples2 = intersect(NPLStoolbox::Cornejo2025$Salivary_microbiome$mode1$subject, outcome$subject) homogenizedSamples3 = intersect(NPLStoolbox::Cornejo2025$Salivary_cytokines$mode1$subject, outcome$subject) homogenizedSamples4 = intersect(NPLStoolbox::Cornejo2025$Salivary_biochemistry$mode1$subject, outcome$subject)  homogenizedSamples = intersect(intersect(homogenizedSamples1, homogenizedSamples2), intersect(homogenizedSamples3,homogenizedSamples4))  outcome = outcome %>% filter(subject %in% homogenizedSamples)  # Tongue newTongue = NPLStoolbox::Cornejo2025$Tongue  mask = newTongue$mode1$subject %in% homogenizedSamples newTongue$data = newTongue$data[mask,,] newTongue$mode1 = newTongue$mode1[mask,]  processedTongue = processDataCube(newTongue, sparsityThreshold = 0.5, considerGroups=TRUE, groupVariable=\"GenderID\", CLR=TRUE, centerMode=1, scaleMode=2)  # Saliva newSaliva = NPLStoolbox::Cornejo2025$Salivary_microbiome  mask = newSaliva$mode1$subject %in% homogenizedSamples newSaliva$data = newSaliva$data[mask,,] newSaliva$mode1 = newSaliva$mode1[mask,]  processedSaliva = processDataCube(newSaliva, sparsityThreshold = 0.5, considerGroups=TRUE, groupVariable=\"GenderID\", CLR=TRUE, centerMode=1, scaleMode=2)  # Cytokines newCytokines = NPLStoolbox::Cornejo2025$Salivary_cytokines  mask = newCytokines$mode1$subject %in% homogenizedSamples newCytokines$data = log(newCytokines$data[mask,,] + 0.1300) newCytokines$mode1 = newCytokines$mode1[mask,]  processedCytokines = processDataCube(newCytokines, CLR=FALSE, centerMode=1, scaleMode=2)  # Biochemistry newBio = NPLStoolbox::Cornejo2025$Salivary_biochemistry  mask = newBio$mode1$subject %in% homogenizedSamples newBio$data = log(newBio$data[mask,,]) newBio$mode1 = newBio$mode1[mask,]  processedBiochemistry = processDataCube(newBio, CLR=FALSE, centerMode=1, scaleMode=2)  # Prep data datasets = list(processedTongue$data, processedSaliva$data, processedCytokines$data, processedBiochemistry$data) modes = list(c(1,2,3),c(1,4,5),c(1,6,7),c(1,8,9)) Z = setupCMTFdata(datasets, modes, normalize=TRUE)  Y = as.matrix(outcome$deltaT) Ycnt = Y - mean(Y) Ynorm = Ycnt / norm(Ycnt, \"2\")"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/GOHTRANS.html","id":"model-selection","dir":"Articles","previous_headings":"ACMTF-R","what":"Model selection","title":"GOHTRANS","text":"","code":"# Please see the separate R scripts at https://doi.org/10.5281/zenodo.16993009 for the model selection. acmtfr_model90 = readRDS(\"./GOHTRANS/GOHTRANS_ACMTFR_model_90_deltaT.RDS\") testMetadata(acmtfr_model90, 1, processedTongue) #> Joining with `by = join_by(subject, GenderID)` #>       Term    Estimate                                       CI    P_value #> 1 GenderID  107.196454  -0.0878380361799178 – 0.302230943724517 0.26223444 #> 2      Age    1.032685 -0.0205386077434815 – 0.0226039782431669 0.92072939 #> 3      BOP   -3.139316  -0.0171356225316767 – 0.010856990431065 0.64207341 #> 4     CODS -183.313346  -0.402449852187934 – 0.0358231592929213 0.09553443 #> 5       XI   -4.486779 -0.0274693780964974 – 0.0184958199200182 0.68556771 #>    P_adjust #> 1 0.6555861 #> 2 0.9207294 #> 3 0.8569596 #> 4 0.4776721 #> 5 0.8569596 testMetadata(acmtfr_model90, 2, processedTongue) #> Joining with `by = join_by(subject, GenderID)` #>       Term    Estimate                                        CI     P_value #> 1 GenderID  266.221675    0.0878259947951316 – 0.444617355260422 0.005861852 #> 2      Age    4.822009  -0.0149089909479829 – 0.0245530087012541 0.612765535 #> 3      BOP    2.819804 -0.00998244764429835 – 0.0156220556012605 0.648039386 #> 4     CODS -115.152380    -0.31559388121747 – 0.0852891217318665 0.242060921 #> 5       XI   -6.577535  -0.0275994394345139 – 0.0144443691718177 0.518009580 #>     P_adjust #> 1 0.02930926 #> 2 0.64803939 #> 3 0.64803939 #> 4 0.60515230 #> 5 0.64803939 lambda = abs(acmtfr_model90$Fac[[10]]) colnames(lambda) = paste0(\"C\", 1:2)  lambda %>%   as_tibble() %>%   mutate(block=c(\"tongue\", \"saliva\", \"cytokines\", \"biochemistry\")) %>%   mutate(block=factor(block, levels=c(\"tongue\", \"saliva\", \"cytokines\", \"biochemistry\"))) %>%   pivot_longer(-block) %>%   ggplot(aes(x=as.factor(name),y=value,fill=as.factor(block))) +   geom_bar(stat=\"identity\",position=position_dodge(),col=\"black\") +   xlab(\"ACMTF-R component number\") +   ylab(expression(lambda)) +   scale_x_discrete(labels=1:3) +   scale_fill_manual(name=\"Dataset\",values = hue_pal()(5),labels=c(\"Tongue microbiome\", \"Salivary microbiome\", \"Salivary cytokines\", \"Salivary biochemistry\")) +   theme(legend.position=\"top\") # Tongue topIndices = processedTongue$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[2]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedTongue$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[2]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(acmtfr_model90$Fac[[1]][,2], acmtf_model$Fac[[2]][,2], acmtf_model$Fac[[3]][,2])  cor(Xhat[,topIndices[1],], Ynorm) # flip #>          [,1] #> [1,] 0.460004 #> [2,] 0.460004 #> [3,] 0.460004 #> [4,] 0.460004 cor(Xhat[,bottomIndices[6],], Ynorm) #>           [,1] #> [1,] -0.460004 #> [2,] -0.460004 #> [3,] -0.460004 #> [4,] -0.460004  # Saliva topIndices = processedSaliva$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[4]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedSaliva$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[4]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(acmtfr_model90$Fac[[1]][,2], acmtfr_model90$Fac[[4]][,2], acmtfr_model90$Fac[[5]][,2])  cor(Xhat[,topIndices[1],], Ynorm) # no flip #>          [,1] #> [1,] 0.460004 #> [2,] 0.460004 #> [3,] 0.460004 #> [4,] 0.460004 cor(Xhat[,bottomIndices[6],], Ynorm) #>           [,1] #> [1,] -0.460004 #> [2,] -0.460004 #> [3,] -0.460004 #> [4,] -0.460004  # Cytokines topIndices = processedCytokines$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[6]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedCytokines$mode2 %>% mutate(index=1:nrow(.), Comp = acmtfr_model90$Fac[[6]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(acmtfr_model90$Fac[[1]][,2], acmtfr_model90$Fac[[6]][,2], acmtfr_model90$Fac[[7]][,2])  cor(Xhat[,topIndices[1],], Ynorm) # no flip #>           [,1] #> [1,] -0.460004 #> [2,]  0.460004 #> [3,]  0.460004 cor(Xhat[,bottomIndices[6],], Ynorm) #>           [,1] #> [1,]  0.460004 #> [2,] -0.460004 #> [3,] -0.460004  # Biochemistry topIndices = 7 bottomIndices = 1  Xhat = parafac4microbiome::reinflateTensor(acmtfr_model90$Fac[[1]][,2], acmtfr_model90$Fac[[8]][,2], acmtfr_model90$Fac[[9]][,2])  cor(Xhat[,topIndices,], Ynorm) # no flip #>          [,1] #> [1,] 0.460004 #> [2,] 0.460004 #> [3,] 0.460004 #> [4,] 0.460004 cor(Xhat[,bottomIndices,], Ynorm) #>           [,1] #> [1,] -0.460004 #> [2,] -0.460004 #> [3,] -0.460004 #> [4,] -0.460004 # Tongue temp = processedTongue$mode2 %>%   as_tibble() %>%   mutate(Component_1 = -1*acmtfr_model90$Fac[[2]][,2]) %>%   mutate(Genus = gsub(\"g__\", \"\", Genus), Species = gsub(\"s__\", \"\", Species)) %>%   mutate(Species = gsub(\"\\\\(\", \"\", Species)) %>%   mutate(Species = gsub(\"\\\\)\", \"\", Species))  fixedSpeciesNames = str_split_fixed(temp$Species, \"/\", 5) %>%    as_tibble() %>%   mutate(dplyr::across(.cols = everything(), .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) fixedSpeciesNames[fixedSpeciesNames$V1 == \"\", \"V1\"] = \"sp.\" fixedSpeciesNames = fixedSpeciesNames %>%    mutate(name=paste0(V1, \"/\", V2)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V3)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V4)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V5)) %>%    mutate(name=gsub(\"/$\", \"\", name))  temp$Species = fixedSpeciesNames$name temp$name = paste0(temp$Genus, \" \", temp$Species) temp[temp$name == \" sp.\", \"name\"] = \"Unclassified\" temp[temp$name == \" \", \"name\"] = \"Unclassified\" temp[temp$name == \" sp.\", \"name\"] = \"Unclassified\"  temp = temp %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.)) %>%   filter(index %in% c(1:10,228:237))  a=temp %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(Phylum))) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=temp$name) +   xlab(\"Loading\") +   ylab(\"\") +   scale_fill_manual(name=\"Phylum\", labels=c(\"Actinobacteria\", \"Bacteroidetes\", \"Firmicutes\", \"Proteobacteria\"), values=hue_pal()(5)[-4]) +   theme(text=element_text(size=16))  # Saliva comp 1 temp = processedSaliva$mode2 %>%   as_tibble() %>%   mutate(Component_1 = acmtfr_model90$Fac[[4]][,2]) %>%   mutate(Genus = gsub(\"g__\", \"\", Genus), Species = gsub(\"s__\", \"\", Species)) %>%   mutate(Species = gsub(\"\\\\(\", \"\", Species)) %>%   mutate(Species = gsub(\"\\\\)\", \"\", Species))  fixedSpeciesNames = str_split_fixed(temp$Species, \"/\", 5) %>%    as_tibble() %>%   mutate(dplyr::across(.cols = everything(), .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) fixedSpeciesNames[fixedSpeciesNames$V1 == \"\", \"V1\"] = \"sp.\" fixedSpeciesNames = fixedSpeciesNames %>%    mutate(name=paste0(V1, \"/\", V2)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V3)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V4)) %>%    mutate(name=gsub(\"/$\", \"\", name)) %>%    mutate(name=paste0(name, \"/\", V5)) %>%    mutate(name=gsub(\"/$\", \"\", name))  temp$Species = fixedSpeciesNames$name temp$name = paste0(temp$Genus, \" \", temp$Species) temp[temp$name == \" sp.\", \"name\"] = \"Unclassified\" temp[temp$name == \" \", \"name\"] = \"Unclassified\" temp[temp$name == \" sp.\", \"name\"] = \"Unclassified\"  temp = temp %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.)) %>%   filter(index %in% c(1:10,260:269))  b=temp %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(Phylum))) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=temp$name) +   xlab(\"Loading\") +   ylab(\"\") +   guides(fill=guide_legend(title=\"Phylum\")) +   theme(text=element_text(size=16))  # Cytokines temp = processedCytokines$mode2 %>%   mutate(Comp = acmtfr_model90$Fac[[6]][,2]) %>%   arrange(Comp) %>%   mutate(index=1:nrow(.)) %>%   mutate(V1 = gsub(\"_pg_ml\", \"\", V1)) %>%   mutate(V1 = gsub(\"_\", \"-\", V1))  c = temp %>%   ggplot(aes(x=Comp,y=as.factor(index))) +   geom_bar(stat=\"identity\", col=\"black\") +   xlab(\"Loading\") +   ylab(\"\") +   scale_y_discrete(labels=temp$V1) +   theme(text=element_text(size=16))  # Biochemistry comp 1 temp = processedBiochemistry$mode2 %>%   mutate(Comp = acmtfr_model90$Fac[[8]][,2]) %>%   arrange(Comp) %>%   mutate(index=1:nrow(.)) %>%   mutate(V1 = c(\"pH\", \"Chitinase\", \"S-IgA\", \"MUC-5B\", \"Amylase\", \"Lysozyme\", \"Total protein\"))  d = temp %>%   ggplot(aes(x=Comp,y=as.factor(index))) +   geom_bar(stat=\"identity\", col=\"black\") +   xlab(\"Loading\") +   ylab(\"\") +   scale_y_discrete(labels=temp$V1) +   theme(text=element_text(size=16))  a b c d a = acmtfr_model90$Fac[[3]][,2] %>% as_tibble() %>% mutate(value=-1*value) %>% mutate(timepoint=c(0,3,6,12)) %>% ggplot(aes(x=timepoint,y=value)) + geom_line() + geom_point() + xlab(\"Time point [months]\") + ylab(\"Loading\") + ylim(0,1)  b = acmtfr_model90$Fac[[5]][,2] %>% as_tibble() %>% mutate(value=-1*value) %>% mutate(timepoint=c(0,3,6,12)) %>% ggplot(aes(x=timepoint,y=value)) + geom_line() + geom_point() + xlab(\"Time point [months]\") + ylab(\"Loading\") + ylim(0,1)  c = acmtfr_model90$Fac[[7]][,2] %>% as_tibble() %>% mutate(value=-1*value) %>% mutate(timepoint=c(0,3,12)) %>% ggplot(aes(x=timepoint,y=value)) + geom_line() + geom_point() + xlab(\"Time point [months]\") + ylab(\"Loading\") + ylim(-1,1)  d = acmtfr_model90$Fac[[9]][,2] %>% as_tibble() %>% mutate(value=-1*value) %>% mutate(timepoint=c(0,3,6,12)) %>% ggplot(aes(x=timepoint,y=value)) + geom_line() + geom_point() + xlab(\"Time point [months]\") + ylab(\"Loading\") + ylim(0,1)  a b c d"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/Introduction.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Introduction","text":"vignette showcase general use case Coupled Matrix Tensor Factorization (CMTF) models set data simulations.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/Introduction.html","id":"general-tensor-matrix-case","dir":"Articles","previous_headings":"","what":"General tensor-matrix case","title":"Introduction","text":"First simulate case tensor (size 108 x 100 x 10) matrix (size 108 x 100) data obtained, measured 108 ‘subjects’ (mode 1). create random loadings modes corresponding two-component CMTF model. run cmtf_opt() function using two left vectors SVD tensors initial guess. finds correct solution pretty quickly. Note random initialization also possible, take longer converge. f-value result corresponds CMTF loss function value, low case: 1.8945834^{-8}. solution found using 52 iterations. visually verify result plot . Note negative correlations may observed due component flipping, similar Principal Component Analysis alter description found subspace. also difference magnitude simulated components modelled components due CMTF penalizing size vectors.","code":"tensorMatrixData = simTensorMatrixData(I=108, J=100, K=10, L=100, numComponents=2) result_nvec = cmtf_opt(tensorMatrixData$Z, 2, initialization=\"nvec\") a = cbind(tensorMatrixData$A, result_nvec$Fac[[1]]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V3)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"CMTF component 1\") + ggtitle(\"Subject mode (shared)\") + stat_cor() #> Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if #> `.name_repair` is omitted as of tibble 2.0.0. #> ℹ Using compatibility `.name_repair`. #> This warning is displayed once every 8 hours. #> Call `lifecycle::last_lifecycle_warnings()` to see where this warning was #> generated. b = cbind(tensorMatrixData$B, result_nvec$Fac[[2]]) %>% as_tibble() %>% ggplot(aes(x=V2, y=V3)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + ggtitle(\"Feature mode X1\") + stat_cor() c = cbind(tensorMatrixData$C, result_nvec$Fac[[3]]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V3)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + ggtitle(\"Condition mode X1\") + stat_cor() d = cbind(tensorMatrixData$D, result_nvec$Fac[[4]]) %>% as_tibble() %>% ggplot(aes(x=V2, y=V3)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + ggtitle(\"Feature mode X2\") + stat_cor()  e = cbind(tensorMatrixData$A, result_nvec$Fac[[1]]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V4)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"CMTF component 2\") + stat_cor() f = cbind(tensorMatrixData$B, result_nvec$Fac[[2]]) %>% as_tibble() %>% ggplot(aes(x=V1, y=V4)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + stat_cor() g = cbind(tensorMatrixData$C, result_nvec$Fac[[3]]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V4)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + stat_cor() h = cbind(tensorMatrixData$D, result_nvec$Fac[[4]]) %>% as_tibble() %>% ggplot(aes(x=V1, y=V4)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + stat_cor()  ggarrange(a,b,c,d,e,f,g,h, nrow=2, ncol=4)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/Introduction.html","id":"general-two-tensor-case","dir":"Articles","previous_headings":"","what":"General two-tensor case","title":"Introduction","text":"create two tensor datasets sharing subject mode randomly initialized loadings corresponding two components. run cmtf_opt() function using two left vectors SVD tensors initial guess. finds correct solution pretty quickly. f-value result corresponds CMTF loss function value, low case: 6.671611^{-9}. solution found using 22 iterations. visually verify result plot . Note negative correlations may observed due component flipping, similar Principal Component Analysis alter description found subspace. also difference magnitude simulated components modelled components due CMTF penalizing size vectors. concludes brief introduction applying cmtf_opt various types data. -depth analysis robustness towards noise, refer Acar et al., 2011, provides framework replicate CMTF_noise_simulation vignette.","code":"twoTensorData = simTwoTensorData(I=108, J=100, K=10, L=100, M=10, numComponents=2) result_nvec = cmtf_opt(twoTensorData$Z, 2, initialization=\"nvec\") a = cbind(twoTensorData$A, result_nvec$Fac[[1]]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V3)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"CMTF component 1\") + ggtitle(\"Subject mode (shared)\") + stat_cor() b = cbind(twoTensorData$B, result_nvec$Fac[[2]]) %>% as_tibble() %>% ggplot(aes(x=V2, y=V3)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + ggtitle(\"Feature mode X1\") + stat_cor() c = cbind(twoTensorData$C, result_nvec$Fac[[3]]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V3)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + ggtitle(\"Condition mode X1\") + stat_cor() d = cbind(twoTensorData$D, result_nvec$Fac[[4]]) %>% as_tibble() %>% ggplot(aes(x=V2, y=V3)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + ggtitle(\"Feature mode X2\") + stat_cor() e = cbind(twoTensorData$E, result_nvec$Fac[[5]]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V3)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + ggtitle(\"Condition mode X2\") + stat_cor()  f = cbind(twoTensorData$A, result_nvec$Fac[[1]]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V4)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"CMTF component 2\") + stat_cor() g = cbind(twoTensorData$B, result_nvec$Fac[[2]]) %>% as_tibble() %>% ggplot(aes(x=V1, y=V4)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + stat_cor() h = cbind(twoTensorData$C, result_nvec$Fac[[3]]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V4)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + stat_cor() i = cbind(twoTensorData$D, result_nvec$Fac[[4]]) %>% as_tibble() %>% ggplot(aes(x=V1, y=V4)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + stat_cor() j = cbind(twoTensorData$E, result_nvec$Fac[[5]]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V4)) + geom_point() + xlab(\"Simulated loadings\") + ylab(\"\") + stat_cor()  ggarrange(a,b,c,d,e,f,g,h,i,j, nrow=2, ncol=5)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/MAINHEALTH.html","id":"preamble","dir":"Articles","previous_headings":"","what":"Preamble","title":"MAINHEALTH","text":"","code":"testMetadata = function(model, comp, metadata){   transformedSubjectLoadings = model$Fac[[1]][,comp]   transformedSubjectLoadings = transformedSubjectLoadings / norm(transformedSubjectLoadings, \"2\")      result = lm(transformedSubjectLoadings ~ BMI + C.section + Secretor + Lewis + whz.6m, data=metadata$mode1)      # Extract coefficients and confidence intervals   coef_estimates <- summary(result)$coefficients   conf_intervals <- confint(result)      # Remove intercept   coef_estimates <- coef_estimates[rownames(coef_estimates) != \"(Intercept)\", ]   conf_intervals <- conf_intervals[rownames(conf_intervals) != \"(Intercept)\", ]      # Combine into a clean data frame   summary_table <- data.frame(     Term     = rownames(coef_estimates),     Estimate = coef_estimates[, \"Estimate\"] * 1e3,     CI       = paste0(                  conf_intervals[, 1], \" – \",                  conf_intervals[, 2]                ),     P_value  = coef_estimates[, \"Pr(>|t|)\"],     P_adjust = p.adjust(coef_estimates[, \"Pr(>|t|)\"], \"BH\"),     row.names = NULL   )      return(summary_table) } # Old approach # Needed colours: BMI groups (3) and phyla levels (6) # colours = hue_pal()(9) # #show_col(colours) # BMI_cols = colours[c(1,4,7)] # phylum_cols = colours[-c(1,4,7)]  # Rasmus's suggestion colours = RColorBrewer:: brewer.pal(8, \"Dark2\") BMI_cols = c(\"darkgreen\",\"darkgoldenrod\",\"darkred\") #colours[1:3] WHZ_cols = c(\"darkgreen\", \"darkgoldenrod\", \"dodgerblue4\") phylum_cols = colours"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/MAINHEALTH.html","id":"processing","dir":"Articles","previous_headings":"ACMTF","what":"Processing","title":"MAINHEALTH","text":"","code":"homogenizedSamples = intersect(intersect(NPLStoolbox::Jakobsen2025$faeces$mode1 %>% filter(!is.na(BMI)) %>% select(subject) %>% pull(), NPLStoolbox::Jakobsen2025$milkMicrobiome$mode1 %>% filter(!is.na(BMI)) %>% select(subject) %>% pull()), NPLStoolbox::Jakobsen2025$milkMetabolomics$mode1 %>% filter(!is.na(BMI)) %>% select(subject) %>% pull())  # Faeces newFaeces = NPLStoolbox::Jakobsen2025$faeces  mask = newFaeces$mode1$subject %in% homogenizedSamples newFaeces$data = newFaeces$data[mask,,] newFaeces$mode1 = newFaeces$mode1[mask,] processedFaeces = parafac4microbiome::processDataCube(newFaeces, sparsityThreshold = 0.75, centerMode=1, scaleMode=2)  # Milk newMilk = NPLStoolbox::Jakobsen2025$milkMicrobiome  mask = newMilk$mode1$subject %in% homogenizedSamples newMilk$data = newMilk$data[mask,,] newMilk$mode1 = newMilk$mode1[mask,] processedMilk = parafac4microbiome::processDataCube(newMilk, sparsityThreshold=0.85, centerMode=1, scaleMode=2)  # Milk metab newMilkMetab = NPLStoolbox::Jakobsen2025$milkMetabolomics  mask = newMilkMetab$mode1$subject %in% homogenizedSamples newMilkMetab$data = newMilkMetab$data[mask,,] newMilkMetab$mode1 = newMilkMetab$mode1[mask,] processedMilkMetab = parafac4microbiome::processDataCube(newMilkMetab, CLR=FALSE, centerMode=1, scaleMode=2)  datasets = list(processedFaeces$data, processedMilk$data, processedMilkMetab$data) modes = list(c(1,2,3), c(1,4,5), c(1,6,7)) Z = setupCMTFdata(datasets, modes, normalize=TRUE)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/MAINHEALTH.html","id":"model-selection","dir":"Articles","previous_headings":"ACMTF","what":"Model selection","title":"MAINHEALTH","text":"","code":"# Please see the separate R scripts at https://doi.org/10.5281/zenodo.16993009 for the model selection. model_ACMTF = readRDS(\"./MAINHEALTH/ACMTF_model_bmi.RDS\") testMetadata(model_ACMTF, 1, processedFaeces) #>        Term   Estimate                                           CI #> 1       BMI  -2.276732 -0.00450781299767528 – -4.56503944847972e-05 #> 2 C.section   4.715650      -0.0361024191316937 – 0.045533718733486 #> 3  Secretor -84.617925     -0.112828298007938 – -0.0564075514364901 #> 4     Lewis  55.837894        -0.024014950520992 – 0.13569073945265 #> 5    whz.6m   3.157397     -0.0075259356824812 – 0.0138407294998676 #>        P_value     P_adjust #> 1 4.556168e-02 1.139042e-01 #> 2 8.195074e-01 8.195074e-01 #> 3 2.717526e-08 1.358763e-07 #> 4 1.688349e-01 2.813915e-01 #> 5 5.596344e-01 6.995429e-01 testMetadata(model_ACMTF, 2, processedFaeces) #>        Term    Estimate                                         CI      P_value #> 1       BMI  -4.4150025 -0.00694585174854792 – -0.0018841532867865 0.0007595475 #> 2 C.section -40.0909098  -0.0863932916037776 – 0.00621147209552562 0.0890716786 #> 3  Secretor  41.3042948    0.0093035776930651 – 0.0733050118693837 0.0118369347 #> 4     Lewis  72.2848185    -0.0182970492398522 – 0.162866686186581 0.1167744722 #> 5    whz.6m   0.9816376   -0.0111371068252218 – 0.0131003820123962 0.8728860770 #>      P_adjust #> 1 0.003797738 #> 2 0.145968090 #> 3 0.029592337 #> 4 0.145968090 #> 5 0.872886077 lambda = abs(model_ACMTF$Fac[[8]]) colnames(lambda) = paste0(\"C\", 1:2)  lambda %>%   as_tibble() %>%   mutate(block=c(\"Infant faecal microbiome\", \"HM microbiome\", \"HM metabolome\")) %>%   # mutate(block=factor(block, levels=c(\"tongue\", \"lowling\", \"lowinter\", \"upling\", \"upinter\", \"saliva\", \"metab\"))) %>%   pivot_longer(-block) %>%   ggplot(aes(x=as.factor(name),y=value,fill=as.factor(block))) +   geom_bar(stat=\"identity\",position=position_dodge(),col=\"black\") +   xlab(\"ACMTF component number\") +   ylab(expression(lambda)) +   scale_x_discrete(labels=1:3) +   scale_fill_manual(name=\"Dataset\",values = hue_pal()(3),labels=c(\"HM metabolome\", \"HM microbiome\", \"Infant faecal microbiome\")) +   theme(legend.position=\"top\", text=element_text(size=16)) # Faeces topIndices = processedFaeces$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[2]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedFaeces$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[2]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(model_ACMTF$Fac[[1]][,1], model_ACMTF$Fac[[2]][,1], model_ACMTF$Fac[[3]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$Secretor)) # no flip #> [1] 0.4992547 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$Secretor)) #> [1] -0.4992547  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$BMI)) # no flip #> [1] 0.07586748 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$BMI)) #> [1] -0.07586748  # Milk topIndices = processedMilk$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[4]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedMilk$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[4]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = 1 * parafac4microbiome::reinflateTensor(model_ACMTF$Fac[[1]][,1], model_ACMTF$Fac[[4]][,1], model_ACMTF$Fac[[5]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], processedMilk$mode1$Secretor)) # no flip #> [1] 0.5156076 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], processedMilk$mode1$Secretor)) #> [1] -0.5156076  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], processedMilk$mode1$BMI)) # no flip #> [1] 0.07586744 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], processedMilk$mode1$BMI)) #> [1] -0.07586744  # Milk metab topIndices = processedMilkMetab$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[6]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedMilkMetab$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[6]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(model_ACMTF$Fac[[1]][,1], model_ACMTF$Fac[[6]][,1], model_ACMTF$Fac[[7]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$Secretor)) # no flip #> [1] 0.4992547 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$Secretor)) #> [1] -0.4992547  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$BMI)) # no flip #> [1] 0.07586748 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$BMI)) #> [1] -0.07586748 a = processedMilk$mode1 %>%   mutate(Component_1 = model_ACMTF$Fac[[1]][,1]) %>%   ggplot(aes(x=as.factor(Secretor),y=Component_1)) +   geom_boxplot() +   stat_compare_means(comparisons=list(c(\"0\",\"1\")), label=\"p.signif\") +   xlab(\"Secretor status\") +   ylab(\"Loading\") +   scale_x_discrete(labels=c(\"Se-\", \"Se+\")) +   theme(text=element_text(size=16))  df = processedFaeces$mode2 %>%    mutate(Component_1 = model_ACMTF$Fac[[2]][,1]) %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.)) %>%   mutate(Genus = gsub(\"g__\", \"\", V7), Species = gsub(\"s__\", \"\", V8)) %>%    mutate(Species = str_split_fixed(Species, \"_\", 2)[,2]) %>%    mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"organism\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"bacterium\"), \"\", .x))) %>%   filter(index %in% c(1:10, 84:93))    df[df$Genus == \"\" & df$Species == \"\", \"Species\"] = \"Unknown\" df[df$Species == \"\", \"Species\"] = \"sp.\" df$name = paste0(df$Genus, \" \", df$Species)  b = df %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(V3))) +   geom_bar(stat=\"identity\", col=\"black\") +   xlab(\"Loading\") +   ylab(\"\") +   scale_y_discrete(labels=df$name) +   scale_fill_manual(name=\"Phylum\", values=hue_pal()(5)[-c(4,5)], labels=c(\"Actinobacteriota\", \"Bacteroidota\", \"Firmicutes\")) +   theme(text=element_text(size=16))  c = model_ACMTF$Fac[[3]][,1] %>%   as_tibble() %>%    mutate(value=-1*value) %>%    ggplot(aes(x=c(30,60,90),y=value)) +   geom_line() +   geom_point() +   xlab(\"Time point [day]\") +   ylab(\"Loading\") +   ylim(0,1) +   theme(text=element_text(size=16))  df = processedMilk$mode2 %>%   mutate(Component_1 = model_ACMTF$Fac[[4]][,1]) %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.)) %>%   mutate(Genus = gsub(\"g__\", \"\", V7), Species = gsub(\"s__\", \"\", V8)) %>%    mutate(Species = str_split_fixed(Species, \"_\", 2)[,2]) %>%    mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"organism\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"bacterium\"), \"\", .x))) %>%   filter(index %in% c(1:10, 106:115))  df[df$Genus == \"\" & df$Species == \"\", \"Species\"] = \"Unknown\" df[df$Species == \"\", \"Species\"] = \"sp.\" df$name = paste0(df$Genus, \" \", df$Species)  d = df %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(V3))) +   geom_bar(stat=\"identity\", col=\"black\") +   xlab(\"Loading\") +   ylab(\"\") +   scale_y_discrete(labels=df$name) +   scale_fill_manual(name=\"Phylum\", values=hue_pal()(5)[-5], labels=c(\"Actinobacteriota\", \"Bacteroidota\", \"Firmicutes\", \"Proteobacteria\")) +   theme(text=element_text(size=16))  e = model_ACMTF$Fac[[5]][,1] %>%   as_tibble() %>%    mutate(value=value*-1) %>%    ggplot(aes(x=c(0,30,60,90),y=value)) +   geom_line() +   geom_point() +   xlab(\"Time point [day]\") +   ylab(\"Loading\") +   ylim(0,1) +   theme(text=element_text(size=16))  temp = processedMilkMetab$mode2 %>%   mutate(Component_1 = model_ACMTF$Fac[[6]][,1]) %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.)) %>%   filter(index %in% c(1:10, 61:70))  f=temp %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(Class),pattern=as.factor(Class))) +   geom_bar_pattern(stat=\"identity\",                    colour=\"black\",                    pattern=\"stripe\",                    pattern_fill=\"black\",                    pattern_density=0.2,                    pattern_spacing=0.05,                    pattern_angle=45,                    pattern_size=0.2) +   scale_y_discrete(label=temp$Metabolite) +   xlab(\"Loading\") +   ylab(\"\") +   scale_fill_manual(name=\"Class\", values=hue_pal()(7)[-c(3,4,5)], labels=c(\"Amino acids and derivatives\", \"Energy related\", \"Oligosaccharides\", \"Sugars\")) +   theme(text=element_text(size=16))  g = model_ACMTF$Fac[[7]][,1] %>%   as_tibble() %>%    mutate(value=value*-1) %>%    ggplot(aes(x=c(0,30,60,90),y=value)) +   geom_line() +   geom_point() +   xlab(\"Time point [day]\") +   ylab(\"Loading\") +   ylim(0,1) +   theme(text=element_text(size=16))  a b c d e f g # Faeces topIndices = processedFaeces$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[2]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedFaeces$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[2]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(model_ACMTF$Fac[[1]][,2], model_ACMTF$Fac[[2]][,2], model_ACMTF$Fac[[3]][,2])  print(\"Positive loadings:\") print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$Secretor)) print(\"Negative loadings:\") print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$Secretor))  print(\"Positive loadings:\") print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$BMI)) # flip print(\"Negative loadings:\") print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$BMI))  # Milk topIndices = processedMilk$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[4]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedMilk$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[4]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(model_ACMTF$Fac[[1]][,2], model_ACMTF$Fac[[4]][,2], model_ACMTF$Fac[[5]][,2])  print(\"Positive loadings:\") print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$Secretor)) print(\"Negative loadings:\") print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$Secretor))  print(\"Positive loadings:\") print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$BMI)) # flip print(\"Negative loadings:\") print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$BMI))  # MilkMetab topIndices = processedMilkMetab$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[6]][,2]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedMilkMetab$mode2 %>% mutate(index=1:nrow(.), Comp = model_ACMTF$Fac[[6]][,2]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(model_ACMTF$Fac[[1]][,2], model_ACMTF$Fac[[6]][,2], model_ACMTF$Fac[[7]][,2])  print(\"Positive loadings:\") print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$Secretor)) # NO FLIP BE CAREFUL print(\"Negative loadings:\") print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$Secretor))  print(\"Positive loadings:\") print(cor(Xhat[,topIndices[1],1], processedMilkMetab$mode1$BMI)) # flip print(\"Negative loadings:\") print(cor(Xhat[,bottomIndices[1],1], processedMilkMetab$mode1$BMI)) a = processedMilk$mode1 %>%   mutate(Component_1 = model_ACMTF$Fac[[1]][,2]) %>%   ggplot(aes(x=BMI,y=Component_1)) +   geom_point() +   stat_cor() +   xlab(\"ppBMI\") +   ylab(\"Loading\") +   theme(text=element_text(size=16))  df = processedFaeces$mode2 %>%    mutate(Component_1 = -1*model_ACMTF$Fac[[2]][,2]) %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.)) %>%   mutate(Genus = gsub(\"g__\", \"\", V7), Species = gsub(\"s__\", \"\", V8)) %>%    mutate(Species = str_split_fixed(Species, \"_\", 2)[,2]) %>%    mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"organism\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"bacterium\"), \"\", .x))) %>%   filter(index %in% c(1:10, 84:93))    df[df$Genus == \"\" & df$Species == \"\", \"Species\"] = \"Unknown\" df[df$Species == \"\", \"Species\"] = \"sp.\" df$name = paste0(df$Genus, \" \", df$Species)  b = df %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(V3))) +   geom_bar(stat=\"identity\", col=\"black\") +   xlab(\"Loading\") +   ylab(\"\") +   scale_y_discrete(labels=df$name) +   scale_fill_manual(name=\"Phylum\", values=hue_pal()(5)[-5], labels=c(\"Actinobacteriota\", \"Bacteroidota\", \"Firmicutes\", \"Proteobacteria\")) +   theme(text=element_text(size=16))  c = model_ACMTF$Fac[[3]][,2] %>%   as_tibble() %>%    mutate(value=value) %>%    ggplot(aes(x=c(30,60,90),y=value)) +   geom_line() +   geom_point() +   xlab(\"Time point [day]\") +   ylab(\"Loading\") +   ylim(0,1) +   theme(text=element_text(size=16))  df = processedMilk$mode2 %>%   mutate(Component_1 = -1*model_ACMTF$Fac[[4]][,2]) %>%   arrange(Component_1) %>%   mutate(index=1:nrow(.)) %>%   mutate(Genus = gsub(\"g__\", \"\", V7), Species = gsub(\"s__\", \"\", V8)) %>%    mutate(Species = str_split_fixed(Species, \"_\", 2)[,2]) %>%    mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"organism\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"bacterium\"), \"\", .x))) %>%   filter(index %in% c(1:10, 106:115))  df[df$Genus == \"\" & df$Species == \"\", \"Species\"] = \"Unknown\" df[df$Species == \"\", \"Species\"] = \"sp.\" df$name = paste0(df$Genus, \" \", df$Species)    d = df %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(V3))) +   geom_bar(stat=\"identity\", col=\"black\") +   xlab(\"Loading\") +   ylab(\"\") +   scale_y_discrete(labels=df$name) +   scale_fill_manual(name=\"Phylum\", values=hue_pal()(5)[-c(2,5)], labels=c(\"Actinobacteriota\", \"Firmicutes\", \"Proteobacteria\")) +   theme(text=element_text(size=16))  e = model_ACMTF$Fac[[5]][,2] %>%   as_tibble() %>%    mutate(value=value) %>%    ggplot(aes(x=c(0,30,60,90),y=value)) +   geom_line() +   geom_point() +   xlab(\"Time point [day]\") +   ylab(\"Loading\") +   ylim(0,1) +   theme(text=element_text(size=16))  temp = processedMilkMetab$mode2 %>%   mutate(Component_1 = -1*model_ACMTF$Fac[[6]][,2]) %>%   arrange(Component_1) %>%    mutate(index=1:nrow(.)) %>%   filter(index %in% c(1:10, 61:70))  f=temp %>%   ggplot(aes(x=Component_1,y=as.factor(index),fill=as.factor(Class),pattern=as.factor(Class))) +   geom_bar_pattern(stat=\"identity\",                    colour=\"black\",                    pattern=\"stripe\",                    pattern_fill=\"black\",                    pattern_density=0.2,                    pattern_spacing=0.05,                    pattern_angle=45,                    pattern_size=0.2) +   scale_y_discrete(label=temp$Metabolite) +   xlab(\"Loading\") +   ylab(\"\") +   scale_fill_manual(name=\"Class\", values=hue_pal()(7)[-c(3,5)], labels=c(\"Amino acids and derivatives\", \"Energy related\", \"Food derived\", \"Oligosaccharides\", \"Sugars\")) +   theme(text=element_text(size=16))  g = model_ACMTF$Fac[[7]][,2] %>%   as_tibble() %>%    mutate(value=value) %>%    ggplot(aes(x=c(0,30,60,90),y=value)) +   geom_line() +   geom_point() +   xlab(\"Time point [day]\") +   ylab(\"Loading\") +   ylim(0,1) +   theme(text=element_text(size=16))  a b c d e f g"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/MAINHEALTH.html","id":"processing-1","dir":"Articles","previous_headings":"ACMTF-R","what":"Processing","title":"MAINHEALTH","text":"","code":"Y = processedFaeces$mode1$BMI Ycnt = Y - mean(Y) Ynorm = Ycnt / norm(Ycnt, \"2\") # Please see the separate R scripts at https://doi.org/10.5281/zenodo.16993009 for the model selection. model_bmi85 = readRDS(\"./MAINHEALTH/ACMTFR_model_bmi85.RDS\") testMetadata(model_bmi85, 1, processedFaeces) #>        Term  Estimate                                        CI      P_value #> 1       BMI -12.54749 -0.0141506288062251 – -0.0109443440288576 8.871981e-31 #> 2 C.section -18.07510  -0.0474049054595348 – 0.0112547018647361 2.248660e-01 #> 3  Secretor -12.34442 -0.0326149679423391 – 0.00792613218036735 2.303643e-01 #> 4     Lewis  59.60359   0.00222536719880014 – 0.116981813379254 4.187674e-02 #> 5    whz.6m   2.41258  -0.0052639235793006 – 0.0100890833389792 5.350509e-01 #>       P_adjust #> 1 4.435990e-30 #> 2 2.879553e-01 #> 3 2.879553e-01 #> 4 1.046918e-01 #> 5 5.350509e-01 lambda = abs(model_bmi85$Fac[[8]]) colnames(lambda) = paste0(\"C\", 1)  lambda %>%   as_tibble() %>%   mutate(block=c(\"Infant faecal microbiome\", \"HM microbiome\", \"HM metabolome\")) %>%   # mutate(block=factor(block, levels=c(\"tongue\", \"lowling\", \"lowinter\", \"upling\", \"upinter\", \"saliva\", \"metab\"))) %>%   pivot_longer(-block) %>%   ggplot(aes(x=as.factor(name),y=value,fill=as.factor(block))) +   geom_bar(stat=\"identity\",position=position_dodge(),col=\"black\") +   xlab(\"ACMTF-R component number\") +   ylab(expression(lambda)) +   scale_x_discrete(labels=1:3) +   scale_fill_manual(name=\"Dataset\",values = hue_pal()(3),labels=c(\"HM metabolome\", \"HM microbiome\", \"Infant faecal microbiome\")) +   theme(legend.position=\"top\") # Faeces topIndices = processedFaeces$mode2 %>% mutate(index=1:nrow(.), Comp = model_bmi85$Fac[[2]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedFaeces$mode2 %>% mutate(index=1:nrow(.), Comp = model_bmi85$Fac[[2]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(model_bmi85$Fac[[1]][,1], model_bmi85$Fac[[2]][,1], model_bmi85$Fac[[3]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], processedFaeces$mode1$BMI)) # flip #> [1] -0.7880436 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], processedFaeces$mode1$BMI)) #> [1] 0.7880436  # Milk topIndices = processedMilk$mode2 %>% mutate(index=1:nrow(.), Comp = model_bmi85$Fac[[4]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedMilk$mode2 %>% mutate(index=1:nrow(.), Comp = model_bmi85$Fac[[4]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(model_bmi85$Fac[[1]][,1], model_bmi85$Fac[[4]][,1], model_bmi85$Fac[[5]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], processedFaeces$mode1$BMI)) # no flip #> [1] 0.7880436 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], processedFaeces$mode1$BMI)) #> [1] -0.7880436  # Milk Metab topIndices = processedMilkMetab$mode2 %>% mutate(index=1:nrow(.), Comp = model_bmi85$Fac[[6]][,1]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull() bottomIndices = processedMilkMetab$mode2 %>% mutate(index=1:nrow(.), Comp = model_bmi85$Fac[[6]][,1]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()  Xhat = parafac4microbiome::reinflateTensor(model_bmi85$Fac[[1]][,1], model_bmi85$Fac[[6]][,1], model_bmi85$Fac[[7]][,1])  print(\"Positive loadings:\") #> [1] \"Positive loadings:\" print(cor(Xhat[,topIndices[1],1], processedFaeces$mode1$BMI)) # no flip #> [1] 0.7880436 print(\"Negative loadings:\") #> [1] \"Negative loadings:\" print(cor(Xhat[,bottomIndices[1],1], processedFaeces$mode1$BMI)) #> [1] -0.7880436  # Faeces df = processedFaeces$mode2 %>%    mutate(Comp=-1*model_bmi85$Fac[[2]][,1]) %>%   arrange(Comp) %>%   mutate(index=1:nrow(.), name=paste0(V7,\" \", V8)) %>%   mutate(Genus = gsub(\"g__\", \"\", V7), Species = gsub(\"s__\", \"\", V8)) %>%    mutate(Species = str_split_fixed(Species, \"_\", 2)[,2]) %>%    mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"organism\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"bacterium\"), \"\", .x))) %>%   filter(index %in% c(1:10, 84:93))  df[df$Genus == \"\" & df$Species == \"\", \"Species\"] = \"Unknown\" df[df$Species == \"\", \"Species\"] = \"sp.\" df$name = paste0(df$Genus, \" \", df$Species)  a=df %>%   ggplot(aes(x=Comp,y=as.factor(index),fill=as.factor(V3))) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=df$name) +   xlab(\"Loading\") +   ylab(\"\") +   theme(text=element_text(size=16)) +   scale_fill_manual(name=\"Phylum\", values=hue_pal()(5)[-5], labels=c(\"Actinobacteriota\", \"Bacteroidota\", \"Firmicutes\", \"Proteobacteria\"))  # Milk df = processedMilk$mode2 %>% mutate(Comp=model_bmi85$Fac[[4]][,1]) %>%   arrange(Comp) %>%   mutate(index=1:nrow(.), name=paste0(V7,\" \", V8)) %>%   mutate(Genus = gsub(\"g__\", \"\", V7), Species = gsub(\"s__\", \"\", V8)) %>%    mutate(Species = str_split_fixed(Species, \"_\", 2)[,2]) %>%    mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"sp.\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"organism\"), \"\", .x))) %>%   mutate(dplyr::across(.cols = Species, .fns = ~ dplyr::if_else(stringr::str_detect(.x, \"bacterium\"), \"\", .x))) %>%   filter(index %in% c(1:10, 106:115))  df[df$Genus == \"\" & df$Species == \"\", \"Species\"] = \"Unknown\" df[df$Species == \"\", \"Species\"] = \"sp.\" df$name = paste0(df$Genus, \" \", df$Species)  b=df %>%   ggplot(aes(x=Comp,y=as.factor(index),fill=as.factor(V3))) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=df$name) +   xlab(\"Loading\") +   ylab(\"\") +   theme(text=element_text(size=16)) +   scale_fill_manual(name=\"Phylum\", values=hue_pal()(5)[-5], labels=c(\"Actinobacteriota\", \"Bacteroidota\", \"Firmicutes\", \"Proteobacteria\"))  # MilkMetab df = processedMilkMetab$mode2 %>% mutate(Comp=model_bmi85$Fac[[6]][,1]) %>% arrange(Comp) %>% mutate(index=1:nrow(.), name=Metabolite) %>% filter(index %in% c(1:10, 61:70)) c=df %>%   ggplot(aes(x=Comp,y=as.factor(index),fill=as.factor(Class),pattern=as.factor(Class))) +   geom_bar_pattern(stat=\"identity\",                    colour=\"black\",                    pattern=\"stripe\",                    pattern_fill=\"black\",                    pattern_density=0.2,                    pattern_spacing=0.05,                    pattern_angle=45,                    pattern_size=0.2) +   scale_y_discrete(label=df$name) +   xlab(\"Loading\") +   ylab(\"\") +   scale_fill_manual(name=\"Class\", values=hue_pal()(7)[-5], labels=c(\"Amino acids and derivatives\", \"Energy related\", \"Fatty acids and derivatives\", \"Food derived\", \"Oligosaccharides\", \"Sugars\")) +   theme(text=element_text(size=16))  a b c d = (model_bmi85$Fac[[3]]) %>%   as_tibble() %>%   mutate(time=c(30,60,90)) %>%    pivot_longer(-time) %>%   ggplot(aes(x=time,y=value)) +    geom_line() +    geom_point() +   ylim(0,1) +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   theme(text=element_text(size=16)) #> Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if #> `.name_repair` is omitted as of tibble 2.0.0. #> ℹ Using compatibility `.name_repair`. #> This warning is displayed once every 8 hours. #> Call `lifecycle::last_lifecycle_warnings()` to see where this warning was #> generated.  e = (-1*model_bmi85$Fac[[5]]) %>%   as_tibble() %>%   mutate(time=c(0,30,60,90)) %>%    pivot_longer(-time) %>%   ggplot(aes(x=time,y=value)) +    geom_line() +    geom_point() +   ylim(0,1) +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   theme(text=element_text(size=16))  f = (-1*model_bmi85$Fac[[7]]) %>%   as_tibble() %>%   mutate(time=c(0,30,60,90)) %>%    pivot_longer(-time) %>%   ggplot(aes(x=time,y=value)) +    geom_line() +    geom_point() +   ylim(0,1) +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   theme(text=element_text(size=16))  d e f"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/TIFN2.html","id":"preamble","dir":"Articles","previous_headings":"","what":"Preamble","title":"TIFN2","text":"","code":"library(dplyr) #>  #> Attaching package: 'dplyr' #> The following objects are masked from 'package:stats': #>  #>     filter, lag #> The following objects are masked from 'package:base': #>  #>     intersect, setdiff, setequal, union library(tidyr) library(parafac4microbiome) library(NPLStoolbox) library(CMTFtoolbox) #>  #> Attaching package: 'CMTFtoolbox' #> The following object is masked from 'package:NPLStoolbox': #>  #>     npred #> The following objects are masked from 'package:parafac4microbiome': #>  #>     fac_to_vect, reinflateFac, reinflateTensor, vect_to_fac library(ggplot2) library(ggpubr) library(scales) library(ggpattern) rf_data = read.csv(\"./TIFN2/RFdata.csv\") colnames(rf_data) = c(\"subject\", \"id\", \"fotonr\", \"day\", \"group\", \"RFgroup\", \"MQH\", \"SPS(tm)\", \"Area_delta_R30\", \"Area_delta_Rmax\", \"Area_delta_R30_x_Rmax\", \"gingiva_mean_R_over_G\", \"gingiva_mean_R_over_G_upper_jaw\", \"gingiva_mean_R_over_G_lower_jaw\") rf_data = rf_data %>% as_tibble()  rf_data[rf_data$subject == \"VSTPHZ\", 1] = \"VSTPH2\" rf_data[rf_data$subject == \"D2VZH0\", 1] = \"DZVZH0\" rf_data[rf_data$subject == \"DLODNN\", 1] = \"DLODDN\" rf_data[rf_data$subject == \"O3VQFX\", 1] = \"O3VQFQ\" rf_data[rf_data$subject == \"F80LGT\", 1] = \"F80LGF\" rf_data[rf_data$subject == \"26QQR0\", 1] = \"26QQrO\"  rf_data2 = read.csv(\"./TIFN2/red_fluorescence_data.csv\") %>% as_tibble() rf_data2 = rf_data2[,c(2,4,181:192)] rf_data = rf_data %>% left_join(rf_data2) #> Joining with `by = join_by(id, day)`  rf = rf_data %>% select(subject, RFgroup) %>% unique() age_gender = read.csv(\"./TIFN2/Ploeg_subjectMetadata.csv\", sep=\";\") age_gender = age_gender[2:nrow(age_gender),2:ncol(age_gender)] age_gender = age_gender %>% as_tibble() %>% filter(onderzoeksgroep == 0) %>% select(naam, leeftijd, geslacht) colnames(age_gender) = c(\"subject\", \"age\", \"gender\")  # Correction for incorrect subject ids age_gender[age_gender$subject == \"VSTPHZ\", 1] = \"VSTPH2\" age_gender[age_gender$subject == \"D2VZH0\", 1] = \"DZVZH0\" age_gender[age_gender$subject == \"DLODNN\", 1] = \"DLODDN\" age_gender[age_gender$subject == \"O3VQFX\", 1] = \"O3VQFQ\" age_gender[age_gender$subject == \"F80LGT\", 1] = \"F80LGF\" age_gender[age_gender$subject == \"26QQR0\", 1] = \"26QQrO\"  age_gender = age_gender %>% arrange(subject) mapping = c(-14,0,2,5,9,14,21)  testMetadata = function(model, comp, metadata){   transformedSubjectLoadings = transformPARAFACloadings(model$Fac, 1)[,comp]   transformedSubjectLoadings = transformedSubjectLoadings / norm(transformedSubjectLoadings, \"2\")      metadata = metadata$mode1 %>% left_join(vanderPloeg2024$red_fluorescence %>% select(subject,day,Area_delta_R30,plaquepercent,bomppercent) %>% filter(day==14), by=\"subject\")      result = lm(transformedSubjectLoadings ~ plaquepercent + bomppercent + Area_delta_R30 + gender + age, data=metadata)      # Extract coefficients and confidence intervals   coef_estimates <- summary(result)$coefficients   conf_intervals <- confint(result)      # Remove intercept   coef_estimates <- coef_estimates[rownames(coef_estimates) != \"(Intercept)\", ]   conf_intervals <- conf_intervals[rownames(conf_intervals) != \"(Intercept)\", ]      # Combine into a clean data frame   summary_table <- data.frame(     Term     = rownames(coef_estimates),     Estimate = coef_estimates[, \"Estimate\"] * 1e3,     CI       = paste0(                  conf_intervals[, 1], \" – \",                  conf_intervals[, 2]                ),     P_value  = coef_estimates[, \"Pr(>|t|)\"],     P_adjust = p.adjust(coef_estimates[, \"Pr(>|t|)\"], \"BH\"),     row.names = NULL   )      return(summary_table) }  testFeatures = function(model, metadata, componentNum, metadataVar){   df = metadata$mode1 %>% left_join(rf_data %>% filter(day==14)) %>% left_join(age_gender)   topIndices = metadata$mode2 %>% mutate(index=1:nrow(.), Comp = model$Fac[[2]][,componentNum]) %>% arrange(desc(Comp)) %>% head() %>% select(index) %>% pull()   bottomIndices = metadata$mode2 %>% mutate(index=1:nrow(.), Comp = model$Fac[[2]][,componentNum]) %>% arrange(desc(Comp)) %>% tail() %>% select(index) %>% pull()      timepoint = which(abs(model$Fac[[3]][,componentNum]) == max(abs(model$Fac[[3]][,componentNum])))      Xhat = parafac4microbiome::reinflateTensor(model$Fac[[1]][,componentNum], model$Fac[[2]][,componentNum], model$Fac[[3]][,componentNum])   y = df[metadataVar]      print(\"Positive loadings:\")   print(cor(Xhat[,topIndices[1],timepoint], y))   print(\"Negative loadings:\")   print(cor(Xhat[,bottomIndices[1],timepoint], y)) }  plotFeatures = function(mode2, model, componentNum, flip=FALSE){      if(flip==TRUE){     df = mode2 %>% mutate(Comp = -1*model$Fac[[2]][,componentNum]) %>% arrange(Comp) %>% filter(Species != \"\") %>% mutate(index=1:nrow(.), name = paste(Genus, Species))   } else{     df = mode2 %>% mutate(Comp = model$Fac[[2]][,componentNum]) %>% arrange(Comp) %>% filter(Species != \"\") %>% mutate(index=1:nrow(.), name = paste(Genus, Species))   }   df = rbind(df %>% head(n=10), df %>% tail(n=10))      plot=df %>%     ggplot(aes(x=Comp,y=as.factor(index),fill=as.factor(Phylum))) +     geom_bar(stat=\"identity\", col=\"black\") +     scale_y_discrete(label=df$name) +     xlab(\"Loading\") +     ylab(\"\") +     guides(fill=guide_legend(title=\"Phylum\")) +     theme(text=element_text(size=16))      return(plot) } phylum_colors = hue_pal()(7)"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/TIFN2.html","id":"process","dir":"Articles","previous_headings":"ACMTF","what":"Process","title":"TIFN2","text":"","code":"homogenizedSubjects = parafac4microbiome::vanderPloeg2024$metabolomics$mode1$subject mask = parafac4microbiome::vanderPloeg2024$tongue$mode1$subject %in% homogenizedSubjects  # Tongue temp = parafac4microbiome::vanderPloeg2024$tongue temp$data = temp$data[mask,,] temp$mode1 = temp$mode1[mask,] processedTongue = processDataCube(temp, sparsityThreshold=0.50, considerGroups=TRUE, groupVariable=\"RFgroup\", CLR=TRUE, centerMode=1, scaleMode=2)  # Lowling temp = parafac4microbiome::vanderPloeg2024$lower_jaw_lingual temp$data = temp$data[mask,,] temp$mode1 = temp$mode1[mask,] processedLowling = processDataCube(temp, sparsityThreshold=0.50, considerGroups=TRUE, groupVariable=\"RFgroup\", CLR=TRUE, centerMode=1, scaleMode=2)  # Lowinter temp = parafac4microbiome::vanderPloeg2024$lower_jaw_interproximal temp$data = temp$data[mask,,] temp$mode1 = temp$mode1[mask,] processedLowinter = processDataCube(temp, sparsityThreshold=0.50, considerGroups=TRUE, groupVariable=\"RFgroup\", CLR=TRUE, centerMode=1, scaleMode=2)  # Upling temp = parafac4microbiome::vanderPloeg2024$upper_jaw_lingual temp$data = temp$data[mask,,] temp$mode1 = temp$mode1[mask,] processedUpling = processDataCube(temp, sparsityThreshold=0.50, considerGroups=TRUE, groupVariable=\"RFgroup\", CLR=TRUE, centerMode=1, scaleMode=2)  # Upinter temp = parafac4microbiome::vanderPloeg2024$upper_jaw_interproximal temp$data = temp$data[mask,,] temp$mode1 = temp$mode1[mask,] processedUpinter = processDataCube(temp, sparsityThreshold=0.50, considerGroups=TRUE, groupVariable=\"RFgroup\", CLR=TRUE, centerMode=1, scaleMode=2)  # Saliva temp = parafac4microbiome::vanderPloeg2024$saliva temp$data = temp$data[mask,,] temp$mode1 = temp$mode1[mask,] processedSaliva = processDataCube(temp, sparsityThreshold=0.50, considerGroups=TRUE, groupVariable=\"RFgroup\", CLR=TRUE, centerMode=1, scaleMode=2)  # Metabolomics stays the same processedMetabolomics = parafac4microbiome::vanderPloeg2024$metabolomics  # Homogenize datasets = list(processedTongue$data, processedLowling$data, processedLowinter$data, processedUpling$data, processedUpinter$data, processedSaliva$data, processedMetabolomics$data) modes = list(c(1,2,3),c(1,4,5),c(1,6,7),c(1,8,9),c(1,10,11),c(1,12,13),c(1,14,15)) Z = setupCMTFdata(datasets,modes,normalize=TRUE)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/TIFN2.html","id":"model-selection","dir":"Articles","previous_headings":"ACMTF","what":"Model selection","title":"TIFN2","text":"","code":"# Please see the separate R scripts at https://doi.org/10.5281/zenodo.16993009 for the model selection. # acmtf_model = CMTFtoolbox::acmtf_opt(Z, 3, nstart = 100, method=\"L-BFGS\", numCores=10) #  # saveRDS(acmtf_model, \"./acmtf_model.RDS\") acmtf_model = readRDS(\"./TIFN2/acmtf_model.RDS\") testMetadata(acmtf_model, 1, processedTongue) #>             Term   Estimate                                          CI #> 1  plaquepercent  0.4863409  -0.00506844885613745 – 0.00604113058720496 #> 2    bomppercent  2.9652292 -0.000432781614955507 – 0.00636323992350004 #> 3 Area_delta_R30  7.5900807   0.000734950049744098 – 0.0144452114121996 #> 4         gender 86.0214570      -0.010641596321994 – 0.182684510263669 #> 5            age  9.1712962   0.000577075926033553 – 0.0177655165286259 #>      P_value   P_adjust #> 1 0.85983387 0.85983387 #> 2 0.08511896 0.10639870 #> 3 0.03102313 0.09298174 #> 4 0.07937792 0.10639870 #> 5 0.03719270 0.09298174 testMetadata(acmtf_model, 2, processedTongue) #>             Term    Estimate                                          CI #> 1  plaquepercent  -5.5322600 -0.0106693400579514 – -0.000395179879130161 #> 2    bomppercent   0.1529061  -0.00298958068906224 – 0.00329539294300932 #> 3 Area_delta_R30  -2.2288690  -0.00856850683903234 – 0.00411076892021208 #> 4         gender -22.1883942     -0.111582569602603 – 0.0672057811120825 #> 5            age  18.7122978     0.0107643465442291 – 0.0266602490737363 #>        P_value     P_adjust #> 1 3.559350e-02 0.0889837601 #> 2 9.218108e-01 0.9218108424 #> 3 4.798015e-01 0.7715244490 #> 4 6.172196e-01 0.7715244490 #> 5 3.261655e-05 0.0001630827 testMetadata(acmtf_model, 3, processedTongue) #>             Term   Estimate                                         CI #> 1  plaquepercent  0.1361253 -0.00536264865494706 – 0.00563489919269931 #> 2    bomppercent  1.4787774  -0.0018849670226254 – 0.00484252184623444 #> 3 Area_delta_R30  4.9612353  -0.00182476661145919 – 0.0117472372709829 #> 4         gender  2.2390025    -0.0934492779583765 – 0.097927282983282 #> 5            age 14.9701758   0.00646262160971828 – 0.0234777299599013 #>       P_value    P_adjust #> 1 0.960170260 0.962351254 #> 2 0.377912728 0.629854546 #> 3 0.146554101 0.366385252 #> 4 0.962351254 0.962351254 #> 5 0.001070941 0.005354707 lambda = abs(acmtf_model$Fac[[16]]) colnames(lambda) = paste0(\"C\", 1:3)  lambda %>%   as_tibble() %>%   mutate(block=c(\"tongue\", \"lowling\", \"lowinter\", \"upling\", \"upinter\", \"saliva\", \"metab\")) %>%   mutate(block=factor(block, levels=c(\"tongue\", \"lowling\", \"lowinter\", \"upling\", \"upinter\", \"saliva\", \"metab\"))) %>%   pivot_longer(-block) %>%   ggplot(aes(x=as.factor(name),y=value,fill=as.factor(block))) +   geom_bar(stat=\"identity\",position=position_dodge(),col=\"black\") +   xlab(\"ACMTF component number\") +   ylab(expression(lambda)) +   scale_x_discrete(labels=1:3) +   scale_fill_manual(name=\"Dataset\",values = hue_pal()(7),labels=c(\"Tongue\", \"Lower jaw, lingual\", \"Lower jaw, interproximal\", \"Upper jaw, lingual\", \"Upper jaw, interproximal\", \"Salivary microbiome\", \"Salivary metabolome\")) +   theme(legend.position=\"top\") # Component 2 is interpretable as being related to age # it is mainly described by tongue + metab  temp = list() temp$Fac = acmtf_model$Fac[c(1,2,3)] testFeatures(temp, processedTongue, 2, \"age\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] 0.4471952 #> [1] \"Negative loadings:\" #>             age #> [1,] -0.4471952 a = plotFeatures(processedTongue$mode2, temp, 2, flip=FALSE) + scale_fill_manual(values=phylum_colors[-c(5,6,7)])  temp = list() temp$Fac = acmtf_model$Fac[c(1,4,5)] testFeatures(temp, processedLowling, 2, \"age\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] 0.4471952 #> [1] \"Negative loadings:\" #>             age #> [1,] -0.4471952 b = plotFeatures(processedLowling$mode2, temp, 2, flip=FALSE) + scale_fill_manual(values=phylum_colors[-7])  temp = list() temp$Fac = acmtf_model$Fac[c(1,6,7)] testFeatures(temp, processedLowinter, 2, \"age\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] 0.4471952 #> [1] \"Negative loadings:\" #>             age #> [1,] -0.4471952 c = plotFeatures(processedLowinter$mode2, temp, 2, flip=FALSE)  temp = list() temp$Fac = acmtf_model$Fac[c(1,8,9)] testFeatures(temp, processedUpling, 2, \"age\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] 0.4471952 #> [1] \"Negative loadings:\" #>             age #> [1,] -0.4471952 d = plotFeatures(processedUpling$mode2, temp, 2, flip=FALSE)  temp = list() temp$Fac = acmtf_model$Fac[c(1,10,11)] testFeatures(temp, processedUpinter, 2, \"age\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] 0.4471952 #> [1] \"Negative loadings:\" #>             age #> [1,] -0.4471952 e = plotFeatures(processedUpinter$mode2, temp, 2, flip=FALSE)  temp = list() temp$Fac = acmtf_model$Fac[c(1,12,13)] testFeatures(temp, processedSaliva, 2, \"age\") # flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>             age #> [1,] -0.4471952 #> [1] \"Negative loadings:\" #>            age #> [1,] 0.4471952 f = plotFeatures(processedSaliva$mode2, temp, 2, flip=TRUE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtf_model$Fac[c(1,14,15)] testFeatures(temp, processedMetabolomics, 2, \"age\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] 0.4471952 #> [1] \"Negative loadings:\" #>             age #> [1,] -0.4471952  # Metab df = processedMetabolomics$mode2 %>% mutate(Component_2 = acmtf_model$Fac[[14]][,2]) %>% arrange(Component_2) %>% mutate(index=1:nrow(.)) df = rbind(df %>% head(n=10), df %>% tail(n=10))  g=df %>%   ggplot(aes(x=Component_2,y=as.factor(index),fill=as.factor(Type))) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=df$Name) +   xlab(\"Loading\") +   ylab(\"\") +   guides(fill=guide_legend(title=\"Class\")) +   theme(text=element_text(size=16), legend.position=\"none\")  g2 = df %>%   ggplot(aes(x = Component_2, y = as.factor(index),              fill = as.factor(Type),              pattern = as.factor(Type))) +   geom_bar_pattern(stat = \"identity\",                    colour = \"black\",                    pattern = \"stripe\",                    pattern_fill = \"black\",                    pattern_density = 0.2,                    pattern_spacing = 0.05,                    pattern_angle = 45,                    pattern_size = 0.2) +   scale_y_discrete(labels = df$Name) +   xlab(\"Loading\") +   ylab(\"\") +   guides(fill = guide_legend(title = \"Class\"),          pattern = \"none\") +   theme(text = element_text(size = 16),         legend.position = \"top\")  a b c d e f g2 a = processedTongue$mode3 %>%   mutate(Comp = acmtf_model$Fac[[3]][,2], day=c(-14,0,2,5,9,14,21)) %>%   select(-visit,-status) %>%   pivot_longer(-day) %>%   ggplot(aes(x=day,y=value)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)     b = processedLowling$mode3 %>%   mutate(Comp = acmtf_model$Fac[[5]][,2], day=c(-14,0,2,5,9,14,21)) %>%   select(-visit,-status) %>%   pivot_longer(-day) %>%   ggplot(aes(x=day,y=value)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)     c = processedLowinter$mode3 %>%   mutate(Component_1 = acmtf_model$Fac[[7]][,2], day=c(-14,0,2,5,9,14,21)) %>%   select(-visit,-status) %>%   pivot_longer(-day) %>%   ggplot(aes(x=day,y=value)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  d = processedUpling$mode3 %>%   mutate(Component_1 = acmtf_model$Fac[[9]][,2], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  e = processedUpinter$mode3 %>%   mutate(Component_1 = acmtf_model$Fac[[11]][,2], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  f = processedSaliva$mode3 %>%   mutate(Component_1 = -1*acmtf_model$Fac[[13]][,2], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  g = processedMetabolomics$mode3 %>%   mutate(Component_1 = acmtf_model$Fac[[15]][,2], day=c(0,2,5,9,14)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  a b c d e f g # Component 2 is interpretable as being related to age # it is mainly described by tongue + metab  temp = list() temp$Fac = acmtf_model$Fac[c(1,2,3)] testFeatures(temp, processedTongue, 3, \"age\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>           age #> [1,] 0.545521 #> [1] \"Negative loadings:\" #>            age #> [1,] -0.545521 a = plotFeatures(processedTongue$mode2, temp, 3, flip=FALSE) + scale_fill_manual(values=phylum_colors[-c(3,5,6,7)])  temp = list() temp$Fac = acmtf_model$Fac[c(1,4,5)] testFeatures(temp, processedLowling, 3, \"age\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>           age #> [1,] 0.545521 #> [1] \"Negative loadings:\" #>            age #> [1,] -0.545521 b = plotFeatures(processedLowling$mode2, temp, 3, flip=FALSE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtf_model$Fac[c(1,6,7)] testFeatures(temp, processedLowinter, 3, \"age\") # flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] -0.545521 #> [1] \"Negative loadings:\" #>           age #> [1,] 0.545521 c = plotFeatures(processedLowinter$mode2, temp, 3, flip=TRUE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtf_model$Fac[c(1,8,9)] testFeatures(temp, processedUpling, 3, \"age\") # cor says flip, but lambda is negative -> no flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] -0.545521 #> [1] \"Negative loadings:\" #>           age #> [1,] 0.545521 d = plotFeatures(processedUpling$mode2, temp, 3, flip=FALSE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtf_model$Fac[c(1,10,11)] testFeatures(temp, processedUpinter, 3, \"age\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>           age #> [1,] 0.545521 #> [1] \"Negative loadings:\" #>            age #> [1,] -0.545521 e = plotFeatures(processedUpinter$mode2, temp, 3, flip=FALSE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtf_model$Fac[c(1,12,13)] testFeatures(temp, processedSaliva, 3, \"age\") # flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] -0.545521 #> [1] \"Negative loadings:\" #>            age #> [1,] -0.545521 f = plotFeatures(processedSaliva$mode2, temp, 3, flip=TRUE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtf_model$Fac[c(1,14,15)] testFeatures(temp, processedMetabolomics, 3, \"age\") # flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>            age #> [1,] -0.545521 #> [1] \"Negative loadings:\" #>           age #> [1,] 0.545521  # Metab df = processedMetabolomics$mode2 %>% mutate(Component_2 = -1*acmtf_model$Fac[[14]][,3]) %>% arrange(Component_2) %>% mutate(index=1:nrow(.)) df = rbind(df %>% head(n=10), df %>% tail(n=10))  g=df %>%   ggplot(aes(x=Component_2,y=as.factor(index),fill=as.factor(Type))) +   geom_bar(stat=\"identity\", col=\"black\") +   scale_y_discrete(label=df$Name) +   xlab(\"Loading\") +   ylab(\"\") +   guides(fill=guide_legend(title=\"Class\")) +   theme(text=element_text(size=16), legend.position=\"none\")  g2 = df %>%   ggplot(aes(x = Component_2, y = as.factor(index),              fill = as.factor(Type),              pattern = as.factor(Type))) +   geom_bar_pattern(stat = \"identity\",                    colour = \"black\",                    pattern = \"stripe\",                    pattern_fill = \"black\",                    pattern_density = 0.2,                    pattern_spacing = 0.05,                    pattern_angle = 45,                    pattern_size = 0.2) +   scale_y_discrete(labels = df$Name) +   xlab(\"Loading\") +   ylab(\"\") +   guides(fill = guide_legend(title = \"Class\"),          pattern = \"none\") +   theme(text = element_text(size = 16),         legend.position = \"top\")  a b c d e f g2 a = processedTongue$mode3 %>%   mutate(Comp = acmtf_model$Fac[[3]][,3], day=c(-14,0,2,5,9,14,21)) %>%   select(-visit,-status) %>%   pivot_longer(-day) %>%   ggplot(aes(x=day,y=value)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)     b = processedLowling$mode3 %>%   mutate(Comp = acmtf_model$Fac[[5]][,3], day=c(-14,0,2,5,9,14,21)) %>%   select(-visit,-status) %>%   pivot_longer(-day) %>%   ggplot(aes(x=day,y=value)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)     c = processedLowinter$mode3 %>%   mutate(Component_1 = -1*acmtf_model$Fac[[7]][,3], day=c(-14,0,2,5,9,14,21)) %>%   select(-visit,-status) %>%   pivot_longer(-day) %>%   ggplot(aes(x=day,y=value)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  d = processedUpling$mode3 %>%   mutate(Component_1 = -1*acmtf_model$Fac[[9]][,3], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  e = processedUpinter$mode3 %>%   mutate(Component_1 = acmtf_model$Fac[[11]][,3], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  f = processedSaliva$mode3 %>%   mutate(Component_1 = -1*acmtf_model$Fac[[13]][,3], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(-1,1)  g = processedMetabolomics$mode3 %>%   mutate(Component_1 = -1*acmtf_model$Fac[[15]][,3], day=c(0,2,5,9,14)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  a b c d e f g"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/TIFN2.html","id":"processing","dir":"Articles","previous_headings":"ACMTF-R","what":"Processing","title":"TIFN2","text":"","code":"Y = processedTongue$mode1 %>% left_join(rf_data %>% select(subject,Area_delta_R30,day) %>% filter(day==14)) %>% select(Area_delta_R30) %>% pull() #> Joining with `by = join_by(subject)` Ycnt = Y - mean(Y) Ynorm = Ycnt / norm(Ycnt, \"2\")"},{"path":"https://grvanderploeg.com/CMTFtoolbox/articles/TIFN2.html","id":"model-selection-1","dir":"Articles","previous_headings":"ACMTF-R","what":"Model selection","title":"TIFN2","text":"","code":"# Please see the separate R scripts at https://doi.org/10.5281/zenodo.16993009 for the model selection. acmtfr_model80 = readRDS(\"./TIFN2/TIFN2_ACMTFR_model_0.8.RDS\") lambda = abs(acmtfr_model80$Fac[[16]]) colnames(lambda) = paste0(\"C\", 1)  lambda %>%   as_tibble() %>%   mutate(block=c(\"tongue\", \"lowling\", \"lowinter\", \"upling\", \"upinter\", \"saliva\", \"metab\")) %>%   mutate(block=factor(block, levels=c(\"tongue\", \"lowling\", \"lowinter\", \"upling\", \"upinter\", \"saliva\", \"metab\"))) %>%   pivot_longer(-block) %>%   ggplot(aes(x=as.factor(name),y=value,fill=as.factor(block))) +   geom_bar(stat=\"identity\",position=position_dodge(),col=\"black\") +   xlab(\"ACMTF-R component number\") +   ylab(expression(lambda)) +   scale_x_discrete(labels=1:3) +   scale_fill_manual(name=\"Dataset\",values = hue_pal()(7),labels=c(\"Tongue\", \"Lower jaw, lingual\", \"Lower jaw, interproximal\", \"Upper jaw, lingual\", \"Upper jaw, interproximal\", \"Salivary microbiome\", \"Salivary metabolome\")) +   theme(legend.position=\"top\") testMetadata(acmtfr_model80, 1, processedTongue) #>             Term   Estimate                                          CI #> 1  plaquepercent  -2.353174  -0.00656449861760044 – 0.00185815139043573 #> 2    bomppercent  -2.345146 -0.00492132427908455 – 0.000231031951626678 #> 3 Area_delta_R30 -15.278510   -0.0204756794088214 – -0.0100813405804632 #> 4         gender -72.149196     -0.145433613790882 – 0.0011352227246296 #> 5            age  -1.139687  -0.00765533504288667 – 0.00537596106673432 #>        P_value     P_adjust #> 1 2.640812e-01 3.301015e-01 #> 2 7.302173e-02 1.217029e-01 #> 3 9.298468e-07 4.649234e-06 #> 4 5.345353e-02 1.217029e-01 #> 5 7.244329e-01 7.244329e-01 # Pi = 0.8 temp = list() temp$Fac = acmtfr_model80$Fac[c(1,2,3)] testFeatures(temp, processedTongue, 1, \"Area_delta_R30\") # flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>      Area_delta_R30 #> [1,]     -0.7233091 #> [1] \"Negative loadings:\" #>      Area_delta_R30 #> [1,]      0.7233091 a = plotFeatures(processedTongue$mode2, temp, 1, flip=TRUE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtfr_model80$Fac[c(1,4,5)] testFeatures(temp, processedLowling, 1, \"Area_delta_R30\") # flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>      Area_delta_R30 #> [1,]     -0.7233091 #> [1] \"Negative loadings:\" #>      Area_delta_R30 #> [1,]      0.7233091 b = plotFeatures(processedLowling$mode2, temp, 1, flip=TRUE) + scale_fill_manual(values=phylum_colors[-7])  temp = list() temp$Fac = acmtfr_model80$Fac[c(1,6,7)] testFeatures(temp, processedLowinter, 1, \"Area_delta_R30\") # flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>      Area_delta_R30 #> [1,]     -0.7233091 #> [1] \"Negative loadings:\" #>      Area_delta_R30 #> [1,]      0.7233091 c = plotFeatures(processedLowinter$mode2, temp, 1, flip=TRUE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtfr_model80$Fac[c(1,8,9)] testFeatures(temp, processedUpling, 1, \"Area_delta_R30\") #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>      Area_delta_R30 #> [1,]      0.7233091 #> [1] \"Negative loadings:\" #>      Area_delta_R30 #> [1,]     -0.7233091 d = plotFeatures(processedUpling$mode2, temp, 1, flip=FALSE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtfr_model80$Fac[c(1,10,11)] testFeatures(temp, processedUpinter, 1, \"Area_delta_R30\") # flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>      Area_delta_R30 #> [1,]     -0.7233091 #> [1] \"Negative loadings:\" #>      Area_delta_R30 #> [1,]      0.7233091 e = plotFeatures(processedUpinter$mode2, temp, 1, flip=TRUE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  temp = list() temp$Fac = acmtfr_model80$Fac[c(1,12,13)] testFeatures(temp, processedSaliva, 1, \"Area_delta_R30\") # flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>      Area_delta_R30 #> [1,]     -0.7233091 #> [1] \"Negative loadings:\" #>      Area_delta_R30 #> [1,]      0.7233091 f = plotFeatures(processedSaliva$mode2, temp, 1, flip=TRUE) + scale_fill_manual(values=phylum_colors[-c(3,7)])  # Metab temp = list() temp$Fac = acmtfr_model80$Fac[c(1,14,15)] testFeatures(temp, processedMetabolomics, 1, \"Area_delta_R30\") # no flip #> Joining with `by = join_by(subject, RFgroup)` #> Joining with `by = join_by(subject, age, gender)` #> [1] \"Positive loadings:\" #>      Area_delta_R30 #> [1,]      0.7233091 #> [1] \"Negative loadings:\" #>      Area_delta_R30 #> [1,]     -0.7233091  df = processedMetabolomics$mode2 %>% mutate(Component_2 = acmtfr_model80$Fac[[14]][,1]) %>% arrange(Component_2) %>% mutate(index=1:nrow(.)) df = rbind(df %>% head(n=10), df %>% tail(n=10))  g = df %>%   ggplot(aes(x = Component_2, y = as.factor(index),              fill = as.factor(Type),              pattern = as.factor(Type))) +   geom_bar_pattern(stat = \"identity\",                    colour = \"black\",                    pattern = \"stripe\",                    pattern_fill = \"black\",                    pattern_density = 0.2,                    pattern_spacing = 0.05,                    pattern_angle = 45,                    pattern_size = 0.2) +   scale_y_discrete(labels = df$Name) +   xlab(\"Loading\") +   ylab(\"\") +   guides(fill = guide_legend(title = \"Class\"),          pattern = \"none\") +   theme(text = element_text(size = 16),         legend.position = \"top\")  a b c d e f g a = processedTongue$mode3 %>%   mutate(Comp = acmtfr_model80$Fac[[3]][,1], day=c(-14,0,2,5,9,14,21)) %>%   select(-visit,-status) %>%   pivot_longer(-day) %>%   ggplot(aes(x=day,y=value)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  b = processedLowling$mode3 %>%   mutate(Component_1 = acmtfr_model80$Fac[[5]][,1], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  c = processedLowinter$mode3 %>%   mutate(Component_1 = acmtfr_model80$Fac[[7]][,1], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  d = processedUpling$mode3 %>%   mutate(Component_1 = -1*acmtfr_model80$Fac[[9]][,1], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)  e = processedUpinter$mode3 %>%   mutate(Component_1 = acmtfr_model80$Fac[[11]][,1], day=c(-14,0,2,5,9,14,21)) %>%   ggplot(aes(x=day,y=Component_1)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)    f = processedSaliva$mode3 %>%   mutate(Comp = acmtfr_model80$Fac[[13]][,1], day=c(-14,0,2,5,9,14,21)) %>%   select(-visit,-status) %>%   pivot_longer(-day) %>%   ggplot(aes(x=day,y=value)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)    g = processedMetabolomics$mode3 %>%   mutate(Comp = acmtfr_model80$Fac[[15]][,1], day=c(0,2,5,9,14)) %>%   select(-visit,-status) %>%   pivot_longer(-day) %>%   ggplot(aes(x=day,y=-1*value)) +   annotate(geom = \"rect\", xmin = 0, xmax = 14, ymin = -Inf, ymax = Inf, fill = \"red\", colour = \"black\", alpha=0.25) +   geom_line() +   geom_point() +   theme(legend.position=\"none\") +   xlab(\"Time point [days]\") +   ylab(\"Loading\") +   ylim(0,1)    a b c d e f g"},{"path":"https://grvanderploeg.com/CMTFtoolbox/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Geert Roelof van der Ploeg. Author, maintainer. Johan Westerhuis. Contributor. Anna Heintz-Buschart. Contributor. Age Smilde. Contributor. University Amsterdam. Copyright holder, funder.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"van der Ploeg G (2025). CMTFtoolbox: Create (Advanced) Coupled Matrix Tensor Factorization Models. R package version 1.0.1, https://grvanderploeg.com/CMTFtoolbox/.","code":"@Manual{,   title = {CMTFtoolbox: Create (Advanced) Coupled Matrix and Tensor Factorization Models},   author = {Geert Roelof {van der Ploeg}},   year = {2025},   note = {R package version 1.0.1},   url = {https://grvanderploeg.com/CMTFtoolbox/}, }"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/index.html","id":"overview","dir":"","previous_headings":"","what":"Overview","title":"Create (Advanced) Coupled Matrix and Tensor Factorization Models","text":"CMTFtoolbox package provides R users two data fusion methods previously presented MATLAB sphere. cmtf_opt: Coupled Matrix Tensor Factorization (CMTF) (doi:10.48550/arXiv.1105.3422). acmtf_opt: Advanced Coupled Matrix Tensor Factorization (ACMTF) (doi:10.1186/1471-2105-15-239). acmtfr_opt: ACMTF-regression (ACMTF-R) described van der Ploeg et al., 2025 (see citation ). methods implemented using --optimization approaches described papers . implementation achieved using S4 Tensor object rTensor various conjugate gradient approaches mize. features package include: ACMTF_modelSelection: Combined random initialization cross-validation approach determining correct number components ACMTF. ACMTFR_modelSelection: Combined random initialization cross-validation approach determining correct number components ACMTF-R. npred: Prediction Y new sample using existing ACMTF-R model. Georgiou2025: example dataset containing tensor inflammatory mediator data matrix tooth microbiome data cohort apical periodontitis patients (doi:10.1111/iej.13854 doi:10.1111/iej.13912).","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Create (Advanced) Coupled Matrix and Tensor Factorization Models","text":"CMTFtoolbox package can installed CRAN using:","code":"install.packages(\"CMTFtoolbox\")"},{"path":"https://grvanderploeg.com/CMTFtoolbox/index.html","id":"development-version","dir":"","previous_headings":"","what":"Development version","title":"Create (Advanced) Coupled Matrix and Tensor Factorization Models","text":"can install development version CMTFtoolbox GitHub :","code":"# install.packages(\"devtools\") devtools::install_github(\"GRvanderPloeg/CMTFtoolbox\")"},{"path":"https://grvanderploeg.com/CMTFtoolbox/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Create (Advanced) Coupled Matrix and Tensor Factorization Models","text":"Please use following citation using package: van der Ploeg, G. R., White, F. T. G., Jakobsen, R. R., Westerhuis, J., Heintz-Buschart, ., & Smilde, . (2024). ACMTF-R: supervised multi-omics data integration uncovering shared distinct outcome-associated variation. bioRxiv. 2025.07.28.667162; doi:10.1101/2025.07.28.667162","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/index.html","id":"usage","dir":"","previous_headings":"","what":"Usage","title":"Create (Advanced) Coupled Matrix and Tensor Factorization Models","text":"","code":"library(CMTFtoolbox)  set.seed(123) numComponents = 3 I = 108 J = 100 K = 10 L = 100 A = array(rnorm(I*numComponents), c(I, numComponents))  # shared subject mode B = array(rnorm(J*numComponents), c(J, numComponents))  # distinct feature mode of X1 C = array(rnorm(K*numComponents), c(K, numComponents))  # distinct time mode of X1 D = array(rnorm(L*numComponents), c(L, numComponents))  # distinct feature mode of X2 Y = matrix(A[,1]) lambdas = array(c(1, 1, 1, 0, 0, 1), c(2,3))  df1 = array(0L, c(I, J, K)) df2 = array(0L, c(I, L)) for(i in 1:numComponents){   df1 = df1 + lambdas[1,i] * reinflateTensor(A[,i], B[,i], C[,i])   df2 = df2 + lambdas[2,i] * reinflateMatrix(A[,i], D[,i]) } datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4)) Z = setupCMTFdata(datasets, modes, normalize=TRUE)  cmtf_model = cmtf_opt(Z, 3) acmtf_model = acmtf_opt(Z, 3) acmtfr_model = acmtfr_opt(Z, Y, 3)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTFR_modelSelection.html","id":null,"dir":"Reference","previous_headings":"","what":"Model selection for ACMTFR — ACMTFR_modelSelection","title":"Model selection for ACMTFR — ACMTFR_modelSelection","text":"Model selection ACMTFR","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTFR_modelSelection.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Model selection for ACMTFR — ACMTFR_modelSelection","text":"","code":"ACMTFR_modelSelection(   datasets,   modes,   Y,   sharedMode = 1,   maxNumComponents = 5,   alpha = 1,   beta = rep(0.001, length(Z$object)),   epsilon = 1e-08,   pi = 0.5,   normalize = TRUE,   normY = 1,   method = \"CG\",   cg_update = \"HS\",   line_search = \"MT\",   max_iter = 10000,   max_fn = 10000,   abs_tol = 1e-10,   rel_tol = 1e-10,   grad_tol = 1e-10,   nstart = 5,   numCores = 1,   cvFolds = 2 )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTFR_modelSelection.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Model selection for ACMTFR — ACMTFR_modelSelection","text":"datasets List arrays datasets. Multi-way two-way may combined. modes Numbered modes per dataset list. Example element 1: 1 2 3 element 2: 1 4 X tensor Y matrix case shared subject mode. Y Dependent variable (regression part). sharedMode Mode shared blocks, used remove fibers numFolds randomly initialized models. maxNumComponents Maximum number components check (default 3). alpha Scalar penalizing components norm 1 (default 1). beta Vector penalty values dataset, penalizing lambda terms (default 1e-3). epsilon Scalar value make possible compute partial derivatives lambda (default 1e-8). pi Pi value loss function specified Van der Ploeg et al., 2025. normalize Normalize X blocks frobenius norm 1 (default TRUE). normY Normalize Y specific value, (default: 1). method Optimization method use (default = \"CG\", conjugate gradient). See mize::mize() options. cg_update Update method conjugate gradient algorithm, see mize::mize() options (default=\"HS\", Hestenes-Steifel). line_search Line search algorithm use, see mize::mize() options (default=\"MT\", -Thuente). max_iter Maximum number iterations. max_fn Maximum number function evaluations. abs_tol Function tolerance criterion convergence. rel_tol Relative function tolerance criterion convergence. grad_tol Absolute tolerence l2-norm gradient vector. nstart Number models produce (default 1). set higher one, package return best fitted model. numCores Number cores use (default 1). set higher one, package attempt run parallel. cvFolds Number CV folds create (default 10).","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTFR_modelSelection.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Model selection for ACMTFR — ACMTFR_modelSelection","text":"List object containing plots metrics dataframes containing data used create .","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTFR_modelSelection.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Model selection for ACMTFR — ACMTFR_modelSelection","text":"","code":"set.seed(123)  I = 10 J = 5 K = 3 df = array(rnorm(I*J*K), c(I,J,K)) df2 = array(rnorm(I*J*K), c(I,J,K)) datasets = list(df, df2) modes = list(c(1,2,3), c(1,4,5)) Y = as.matrix(rnorm(I))  # A very small procedure is run to limit computational requirements result = ACMTFR_modelSelection(datasets,                               modes,                               Y,                               pi=1.0,                               maxNumComponents=2,                               nstart=2,                               cvFolds=2,                               rel_tol=0.5,                               abs_tol=0.5)  result$plots$overview"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTF_modelSelection.html","id":null,"dir":"Reference","previous_headings":"","what":"Model selection for ACMTF — ACMTF_modelSelection","title":"Model selection for ACMTF — ACMTF_modelSelection","text":"Model selection ACMTF","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTF_modelSelection.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Model selection for ACMTF — ACMTF_modelSelection","text":"","code":"ACMTF_modelSelection(   datasets,   modes,   maxNumComponents = 3,   sharedMode = 1,   alpha = 1,   beta = rep(0.001, length(datasets)),   epsilon = 1e-08,   nstart = 10,   cvFolds = 10,   numCores = 1,   method = \"CG\",   cg_update = \"HS\",   line_search = \"MT\",   max_iter = 10000,   max_fn = 1e+05,   rel_tol = 1e-08,   abs_tol = 1e-08,   grad_tol = 1e-08,   plots = TRUE )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTF_modelSelection.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Model selection for ACMTF — ACMTF_modelSelection","text":"datasets List arrays datasets. Multi-way two-way may combined. modes Numbered modes per dataset list. Example element 1: 1 2 3 element 2: 1 4 X tensor Y matrix case shared subject mode. maxNumComponents Maximum number components check (default 3). sharedMode Mode shared blocks, used remove fibers numFolds randomly initialized models. alpha Scalar penalizing components norm 1 (default 1). beta Vector penalty values dataset, penalizing lambda terms (default 1e-3). epsilon Scalar value make possible compute partial derivatives lambda (default 1e-8). nstart Number randomly initialized models create (default 10). cvFolds Number CV folds create (default 10). numCores Number cores use (default 1). number higher 1 run process parallel. method Optimization method use (default = \"CG\", conjugate gradient). See mize::mize() options. cg_update Update method conjugate gradient algorithm, see mize::mize() options (default=\"HS\", Hestenes-Steifel). line_search Line search algorithm use, see mize::mize() options (default=\"MT\", -Thuente). max_iter Maximum number iterations. max_fn Maximum number function evaluations. rel_tol Relative function tolerance criterion convergence. abs_tol Function tolerance criterion convergence. grad_tol Absolute tolerence l2-norm gradient vector. plots Boolean state plots made outcome.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTF_modelSelection.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Model selection for ACMTF — ACMTF_modelSelection","text":"List object containing variation explained, FMS, degeneracy score metrics. plots=TRUE, plots attached list.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/ACMTF_modelSelection.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Model selection for ACMTF — ACMTF_modelSelection","text":"","code":"set.seed(123)  I = 10 J = 5 K = 3 df = array(rnorm(I*J*K), c(I,J,K)) df2 = array(rnorm(I*J*K), c(I,J,K)) datasets = list(df, df2) modes = list(c(1,2,3), c(1,4,5))  # A very small procedure is run to limit computational requirements # Plots are not made to reduce CRAN runtime. result = ACMTF_modelSelection(datasets,                               modes,                               maxNumComponents=1,                               nstart=2,                               cvFolds=2,                               rel_tol=1e-1,                               abs_tol=1e-1,                               max_iter=2,                               plots=FALSE)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_cv.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Factor Match Score for two models. — FMS_cv","title":"Compute Factor Match Score for two models. — FMS_cv","text":"Compute Factor Match Score two models.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_cv.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Factor Match Score for two models. — FMS_cv","text":"","code":"FMS_cv(Fac1, Fac2, sharedMode = 1)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_cv.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Factor Match Score for two models. — FMS_cv","text":"Fac1 list matrices corresponding found components per mode model 1. Fac2 list matrices corresponding found components per mode model 2. sharedMode shared mode excluded FMS calculation.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_cv.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Factor Match Score for two models. — FMS_cv","text":"Scalar FMS value","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_cv.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute Factor Match Score for two models. — FMS_cv","text":"","code":"set.seed(123)  I = 10 J = 5 K = 3 df = array(rnorm(I*J*K), c(I,J,K)) datasets = list(df, df) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes)  model1 = acmtf_opt(Z, 1)  Fac1 = model1$Fac[1:3] Fac2 = Fac1 # identical models for the purposes of demonstration result = FMS_cv(Fac1, Fac2) # [1] 1"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_random.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Factor Match Score for two models. — FMS_random","title":"Compute Factor Match Score for two models. — FMS_random","text":"Compute Factor Match Score two models.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_random.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Factor Match Score for two models. — FMS_random","text":"","code":"FMS_random(Fac1, Fac2)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_random.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Factor Match Score for two models. — FMS_random","text":"Fac1 list matrices corresponding found components per mode model 1. Fac2 list matrices corresponding found components per mode model 2.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_random.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Factor Match Score for two models. — FMS_random","text":"Scalar FMS value","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/FMS_random.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute Factor Match Score for two models. — FMS_random","text":"","code":"set.seed(123)  I = 10 J = 5 K = 3 df = array(rnorm(I*J*K), c(I,J,K)) datasets = list(df, df) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes)  model1 = acmtf_opt(Z, 1)  Fac1 = model1$Fac[1:3] Fac2 = Fac1 # identical models for the purposes of demonstration result = FMS_random(Fac1, Fac2) # [1] 1"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/Georgiou2025.html","id":null,"dir":"Reference","previous_headings":"","what":"Georgiou2025 Apical Periodontitis data — Georgiou2025","title":"Georgiou2025 Apical Periodontitis data — Georgiou2025","text":"Georgiou longitudinal dataset three-dimensional array matrix, subjects mode 1, features mode 2, time mode3.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/Georgiou2025.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Georgiou2025 Apical Periodontitis data — Georgiou2025","text":"","code":"Georgiou2025"},{"path":[]},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/Georgiou2025.html","id":"georgiou-","dir":"Reference","previous_headings":"","what":"Georgiou2025","title":"Georgiou2025 Apical Periodontitis data — Georgiou2025","text":"list object two elements Inflammatory_mediators Longitudinally measured inflammatory mediator data. Tooth_microbiome Single-timepoint tooth microbiome data extracted tooth","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/Georgiou2025.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Georgiou2025 Apical Periodontitis data — Georgiou2025","text":"TBD","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fg.html","id":null,"dir":"Reference","previous_headings":"","what":"Function value and gradient calculation for ACMTF — acmtf_fg","title":"Function value and gradient calculation for ACMTF — acmtf_fg","text":"Function value gradient calculation ACMTF","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fg.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function value and gradient calculation for ACMTF — acmtf_fg","text":"","code":"acmtf_fg(x, Z, alpha = 1, beta = rep(0.001, length(Z$object)), epsilon = 1e-08)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fg.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function value and gradient calculation for ACMTF — acmtf_fg","text":"x Vectorized parameters CMTF model. Z Z object generated setupCMTFdata(). alpha Alpha value loss function specified Acar et al., 2014 beta Beta value loss function specified Acar et al., 2014 epsilon Epsilon value loss function specified Acar et al., 2014","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fg.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function value and gradient calculation for ACMTF — acmtf_fg","text":"list containing function (\"fn\") gradient (\"gr\").","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fg.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function value and gradient calculation for ACMTF — acmtf_fg","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  init = initializeACMTF(Z, 2, output=\"vect\") outcome = acmtf_fg(init, Z) f = outcome$fn g = outcome$gr"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fun.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate function value of ACMTF — acmtf_fun","title":"Calculate function value of ACMTF — acmtf_fun","text":"Calculate function value ACMTF","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fun.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate function value of ACMTF — acmtf_fun","text":"","code":"acmtf_fun(   x,   Z,   alpha = 1,   beta = rep(0.001, length(Z$object)),   epsilon = 1e-08,   manual = FALSE )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fun.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate function value of ACMTF — acmtf_fun","text":"x Vectorized parameters CMTF model. Z Z object generated setupCMTFdata(). alpha Alpha value loss function specified Acar et al., 2014 beta Beta value loss function specified Acar et al., 2014 epsilon Epsilon value loss function specified Acar et al., 2014 manual Manual calculation loss term (default FALSE)","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fun.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate function value of ACMTF — acmtf_fun","text":"Scalar loss function value (manual=FALSE), otherwise list containing loss terms","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_fun.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate function value of ACMTF — acmtf_fun","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  init = initializeACMTF(Z, 2, output=\"vect\") f = acmtf_fun(init, Z)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_gradient.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate gradient of ACMTF model. — acmtf_gradient","title":"Calculate gradient of ACMTF model. — acmtf_gradient","text":"Calculate gradient ACMTF model.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_gradient.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate gradient of ACMTF model. — acmtf_gradient","text":"","code":"acmtf_gradient(   x,   Z,   alpha = 1,   beta = rep(0.001, length(Z$object)),   epsilon = 1e-08 )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_gradient.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate gradient of ACMTF model. — acmtf_gradient","text":"x Vectorized parameters CMTF model. Z Z object generated setupCMTFdata(). alpha Alpha value loss function specified Acar et al., 2014 beta Beta value loss function specified Acar et al., 2014 epsilon Epsilon value loss function specified Acar et al., 2014","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_gradient.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate gradient of ACMTF model. — acmtf_gradient","text":"Vectorized gradient ACMTF model.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_gradient.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate gradient of ACMTF model. — acmtf_gradient","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  init = initializeACMTF(Z, 2, output=\"vect\") g = acmtf_gradient(init, Z)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_opt.html","id":null,"dir":"Reference","previous_headings":"","what":"Advanced coupled matrix and tensor factorizations — acmtf_opt","title":"Advanced coupled matrix and tensor factorizations — acmtf_opt","text":"Advanced coupled matrix tensor factorizations","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_opt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Advanced coupled matrix and tensor factorizations — acmtf_opt","text":"","code":"acmtf_opt(   Z,   numComponents,   initialization = \"random\",   alpha = 1,   beta = rep(0.001, length(Z$object)),   epsilon = 1e-08,   method = \"CG\",   cg_update = \"HS\",   line_search = \"MT\",   max_iter = 10000,   max_fn = 10000,   abs_tol = 1e-10,   rel_tol = 1e-10,   grad_tol = 1e-10,   nstart = 1,   numCores = 1,   sortComponents = TRUE,   allOutput = FALSE )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_opt.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Advanced coupled matrix and tensor factorizations — acmtf_opt","text":"Z Combined dataset mode object produced setupCMTFdata(). numComponents Number components initialization Initialization, either \"random\" (default) \"nvec\" numComponents components concatenated data using svd. alpha Scalar penalizing components norm 1 (default 1). beta Vector penalty values dataset, penalizing lambda terms (default 1e-3). epsilon Scalar value make possible compute partial derivatives lambda (default 1e-8). method Optimization method use (default = \"CG\", conjugate gradient). See mize::mize() options. cg_update Update method conjugate gradient algorithm, see mize::mize() options (default=\"HS\", Hestenes-Steifel). line_search Line search algorithm use, see mize::mize() options (default=\"MT\", -Thuente). max_iter Maximum number iterations. max_fn Maximum number function evaluations. abs_tol Function tolerance criterion convergence. rel_tol Relative function tolerance criterion convergence. grad_tol Absolute tolerence l2-norm gradient vector. nstart Number models produce (default 1). set higher one, package return best fitted model. numCores Number cores use (default 1). set higher one, package attempt run parallel. sortComponents Sort components output descending order variation explained. allOutput Return created models. Ignored nstart=1.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_opt.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Advanced coupled matrix and tensor factorizations — acmtf_opt","text":"List object, similar mize::mize() output. Includes Fac object model, list components per mode. Also includes init object giving initialized input vectors.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtf_opt.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Advanced coupled matrix and tensor factorizations — acmtf_opt","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  # specific setting to reduce runtime for CRAN model = acmtf_opt(Z, 1, rel_tol=1e-5, abs_tol=1e-5)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fg.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate function value of ACMTF — acmtfr_fg","title":"Calculate function value of ACMTF — acmtfr_fg","text":"Calculate function value ACMTF","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fg.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate function value of ACMTF — acmtfr_fg","text":"","code":"acmtfr_fg(   x,   Z,   Y,   alpha = 1,   beta = rep(0.001, length(Z$object)),   epsilon = 1e-08,   pi = 0.5,   mu = 1e-06 )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fg.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate function value of ACMTF — acmtfr_fg","text":"x Vectorized parameters CMTF model. Z Z object generated setupCMTFdata(). Y Dependent variable (regression part). alpha Alpha value loss function specified Acar et al., 2014 beta Beta value loss function specified Acar et al., 2014 epsilon Epsilon value loss function specified Acar et al., 2014 pi Pi value loss function specified Van der Ploeg et al., 2025. mu Ridge term parameter calculation regression coefficients rho (default = 1e-6).","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fg.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate function value of ACMTF — acmtfr_fg","text":"Scalar loss function value (manual=FALSE), otherwise list containing loss terms.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fg.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate function value of ACMTF — acmtfr_fg","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE) Y = A[,1]  init = initializeACMTF(Z, 2, output=\"vect\") outcome = acmtfr_fg(init, Z, Y) f = outcome$fn g = outcome$gr"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fun.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate function value of ACMTF — acmtfr_fun","title":"Calculate function value of ACMTF — acmtfr_fun","text":"Calculate function value ACMTF","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fun.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate function value of ACMTF — acmtfr_fun","text":"","code":"acmtfr_fun(   x,   Z,   Y,   alpha = 1,   beta = rep(0.001, length(Z$object)),   epsilon = 1e-08,   pi = 0.5,   mu = 1e-06,   manual = FALSE )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fun.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate function value of ACMTF — acmtfr_fun","text":"x Vectorized parameters CMTF model. Z Z object generated setupCMTFdata(). Y Dependent variable (regression part). alpha Alpha value loss function specified Acar et al., 2014 beta Beta value loss function specified Acar et al., 2014 epsilon Epsilon value loss function specified Acar et al., 2014 pi Pi value loss function specified Van der Ploeg et al., 2025. mu Ridge term parameter calculation regression coefficients rho (default = 1e-6). manual Manual calculation loss term (default FALSE).","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fun.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate function value of ACMTF — acmtfr_fun","text":"Scalar loss function value (manual=FALSE), otherwise list containing loss terms.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_fun.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate function value of ACMTF — acmtfr_fun","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE) Y = A[,1]  init = initializeACMTF(Z, 2, output=\"vect\") f = acmtfr_fun(init, Z, Y)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_gradient.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate gradient of ACMTF model. — acmtfr_gradient","title":"Calculate gradient of ACMTF model. — acmtfr_gradient","text":"Calculate gradient ACMTF model.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_gradient.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate gradient of ACMTF model. — acmtfr_gradient","text":"","code":"acmtfr_gradient(   x,   Z,   Y,   alpha = 1,   beta = rep(0.001, length(Z$object)),   epsilon = 1e-08,   pi = 0.5,   mu = 1e-06 )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_gradient.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate gradient of ACMTF model. — acmtfr_gradient","text":"x Vectorized parameters CMTF model. Z Z object generated setupCMTFdata(). Y Dependent variable (regression part). alpha Alpha value loss function specified Acar et al., 2014 beta Beta value loss function specified Acar et al., 2014 epsilon Epsilon value loss function specified Acar et al., 2014 pi Pi value loss function specified Van der Ploeg et al., 2025. mu Ridge term parameter calculation regression coefficients rho (default = 1e-6).","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_gradient.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate gradient of ACMTF model. — acmtfr_gradient","text":"Vectorized gradient ACMTF regression model.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_gradient.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate gradient of ACMTF model. — acmtfr_gradient","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE) Y = A[,1]  init = initializeACMTF(Z, 2, output=\"vect\") g = acmtfr_gradient(init, Z, Y)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_opt.html","id":null,"dir":"Reference","previous_headings":"","what":"Advanced coupled matrix and tensor factorizations — acmtfr_opt","title":"Advanced coupled matrix and tensor factorizations — acmtfr_opt","text":"Advanced coupled matrix tensor factorizations","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_opt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Advanced coupled matrix and tensor factorizations — acmtfr_opt","text":"","code":"acmtfr_opt(   Z,   Y,   numComponents,   initialization = \"random\",   alpha = 1,   beta = rep(0.001, length(Z$object)),   epsilon = 1e-08,   pi = 0.5,   mu = 1e-06,   method = \"CG\",   cg_update = \"HS\",   line_search = \"MT\",   max_iter = 10000,   max_fn = 10000,   abs_tol = 1e-10,   rel_tol = 1e-10,   grad_tol = 1e-10,   nstart = 1,   numCores = 1,   sortComponents = TRUE,   allOutput = FALSE )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_opt.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Advanced coupled matrix and tensor factorizations — acmtfr_opt","text":"Z Combined dataset mode object produced setupCMTFdata(). Y Dependent variable (regression part). numComponents Number components initialization Initialization, either \"random\" (default) \"nvec\" numComponents components concatenated data using svd. Ignored uses NPLS based initialization pi=0. alpha Scalar penalizing components norm 1 (default 1). beta Vector penalty values dataset, penalizing lambda terms (default 1e-3). epsilon Scalar value make possible compute partial derivatives lambda (default 1e-8). pi Pi value loss function specified Van der Ploeg et al., 2025. mu Ridge term parameter calculation regression coefficients rho (default = 1e-6). method Optimization method use (default = \"CG\", conjugate gradient). See mize::mize() options. cg_update Update method conjugate gradient algorithm, see mize::mize() options (default=\"HS\", Hestenes-Steifel). line_search Line search algorithm use, see mize::mize() options (default=\"MT\", -Thuente). max_iter Maximum number iterations. max_fn Maximum number function evaluations. abs_tol Function tolerance criterion convergence. rel_tol Relative function tolerance criterion convergence. grad_tol Absolute tolerence l2-norm gradient vector. nstart Number models produce (default 1). set higher one, package return best fitted model. numCores Number cores use (default 1). set higher one, package attempt run parallel. sortComponents Sort components output descending order variation explained. allOutput Return created models. Ignored nstart=1.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_opt.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Advanced coupled matrix and tensor factorizations — acmtfr_opt","text":"List object, similar mize::mize() output. Includes Fac object model, list components per mode. Also includes init object giving initialized input vectors.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/acmtfr_opt.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Advanced coupled matrix and tensor factorizations — acmtfr_opt","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) Y = A[,1] datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  # specific setting to reduce runtime for CRAN model = acmtfr_opt(Z, Y, 2, rel_tol=1e-5, abs_tol=1e-5)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fg.html","id":null,"dir":"Reference","previous_headings":"","what":"Function value and gradient calculation for CMTF — cmtf_fg","title":"Function value and gradient calculation for CMTF — cmtf_fg","text":"Function value gradient calculation CMTF","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fg.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function value and gradient calculation for CMTF — cmtf_fg","text":"","code":"cmtf_fg(x, Z)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fg.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function value and gradient calculation for CMTF — cmtf_fg","text":"x Vectorized parameters CMTF model. Z Z object generated setupCMTFdata().","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fg.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function value and gradient calculation for CMTF — cmtf_fg","text":"list containing function (\"fn\") gradient (\"gr\").","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fg.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function value and gradient calculation for CMTF — cmtf_fg","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  init = initializeCMTF(Z, 2, output=\"vect\") outcome = cmtf_fg(init, Z) f = outcome$fn g = outcome$gr"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fun.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate function value of CMTF — cmtf_fun","title":"Calculate function value of CMTF — cmtf_fun","text":"Calculate function value CMTF","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fun.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate function value of CMTF — cmtf_fun","text":"","code":"cmtf_fun(x, Z, manual = FALSE)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fun.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate function value of CMTF — cmtf_fun","text":"x Vectorized parameters CMTF model. Z Z object generated setupCMTFdata(). manual Manual calculation loss term (default FALSE)","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fun.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate function value of CMTF — cmtf_fun","text":"Function value CMTF loss value manual=FALSE, otherwise vector loss values per term.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_fun.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate function value of CMTF — cmtf_fun","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  init = initializeCMTF(Z, 2, output=\"vect\") f = cmtf_fun(init, Z)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_gradient.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate gradient of CMTF model. — cmtf_gradient","title":"Calculate gradient of CMTF model. — cmtf_gradient","text":"Calculate gradient CMTF model.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_gradient.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate gradient of CMTF model. — cmtf_gradient","text":"","code":"cmtf_gradient(x, Z)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_gradient.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate gradient of CMTF model. — cmtf_gradient","text":"x Vectorized parameters CMTF model. Z Z object generated setupCMTFdata().","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_gradient.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate gradient of CMTF model. — cmtf_gradient","text":"Vectorized gradient CMTF model.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_gradient.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate gradient of CMTF model. — cmtf_gradient","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  init = initializeCMTF(Z, 2, output=\"vect\") g = cmtf_gradient(init, Z)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_opt.html","id":null,"dir":"Reference","previous_headings":"","what":"Coupled matrix and tensor factorizations — cmtf_opt","title":"Coupled matrix and tensor factorizations — cmtf_opt","text":"Coupled matrix tensor factorizations","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_opt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Coupled matrix and tensor factorizations — cmtf_opt","text":"","code":"cmtf_opt(   Z,   numComponents,   initialization = \"random\",   method = \"CG\",   cg_update = \"HS\",   line_search = \"MT\",   max_iter = 10000,   max_fn = 10000,   abs_tol = 1e-08,   rel_tol = 1e-08,   grad_tol = 1e-08,   nstart = 1,   numCores = 1,   sortComponents = TRUE,   allOutput = FALSE )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_opt.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Coupled matrix and tensor factorizations — cmtf_opt","text":"Z Combined dataset mode object produced setupCMTFdata(). numComponents Number components initialization Initialization, either \"random\" (default) \"nvec\" numComponents components concatenated data using svd. method Optimization method use (default = \"CG\", conjugate gradient). See mize::mize() options. cg_update Update method conjugate gradient algorithm, see mize::mize() options (default=\"HS\", Hestenes-Steifel). line_search Line search algorithm use, see mize::mize() options (default=\"MT\", -Thuente). max_iter Maximum number iterations. max_fn Maximum number function evaluations. abs_tol Function tolerance criterion convergence. rel_tol Relative function tolerance criterion convergence. grad_tol Absolute tolerence l2-norm gradient vector. nstart Number models produce (default 1). set higher one, package return best fitted model. numCores Number cores use (default 1). set higher one, package attempt run parallel. sortComponents Sort components output descending order variation explained. allOutput Return created models. Ignored nstart=1.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_opt.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Coupled matrix and tensor factorizations — cmtf_opt","text":"List object, similar mize::mize() output. Includes Fac object model, list components per mode. Also includes init object giving initialized input vectors.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/cmtf_opt.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Coupled matrix and tensor factorizations — cmtf_opt","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  model = cmtf_opt(Z, 1, rel_tol=1e-4) # quick convergence for example only"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/computeFMS.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Factor Match Score for two models. — computeFMS","title":"Compute Factor Match Score for two models. — computeFMS","text":"Compute Factor Match Score two models.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/computeFMS.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Factor Match Score for two models. — computeFMS","text":"","code":"computeFMS(Fac1, Fac2, modes)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/computeFMS.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Factor Match Score for two models. — computeFMS","text":"Fac1 list matrices corresponding found components per mode model 1. Fac2 list matrices corresponding found components per mode model 2. modes List modes per dataset.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/computeFMS.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Factor Match Score for two models. — computeFMS","text":"Vector FMS scores, one per dataset.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/computeFMS.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute Factor Match Score for two models. — computeFMS","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100, 2)) E = array(rnorm(10*2), c(10, 2))  Fac1 = list(A,B,C,D,E) Fac2 = Fac1 # identical models for the purposes of demonstration modes = list(c(1,2,3), c(1,4,5)) FMS_result = computeFMS(Fac1, Fac2, modes) # FMS_result = c(1,1)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/degenScore.html","id":null,"dir":"Reference","previous_headings":"","what":"degenScore — degenScore","title":"degenScore — degenScore","text":"Computes maximum absolute -diagonal Tucker congruence coefficient subject-mode components ACMTF model. metric serves diagnostic tool detect potential degeneracy subject-mode loadings.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/degenScore.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"degenScore — degenScore","text":"","code":"degenScore(A)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/degenScore.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"degenScore — degenScore","text":"numeric matrix subject-mode loadings (dimensions: subjects x components).","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/degenScore.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"degenScore — degenScore","text":"numeric scalar representing maximum absolute -diagonal Tucker congruence components.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/degenScore.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"degenScore — degenScore","text":"high degenScore (e.g., > 0.85) indicates two components subject mode highly similar, suggesting possible degeneracy lack uniqueness. low value (e.g., < 0.3) indicates well-separated components.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/degenScore.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"degenScore — degenScore","text":"","code":"# Example: Compute degenScore for a random loading matrix A <- matrix(rnorm(100), nrow = 10, ncol = 10) degenScore(A) #> [1] 0.6161486"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/fac_to_vect.html","id":null,"dir":"Reference","previous_headings":"","what":"Vectorize Fac object — fac_to_vect","title":"Vectorize Fac object — fac_to_vect","text":"Vectorize Fac object","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/fac_to_vect.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Vectorize Fac object — fac_to_vect","text":"","code":"fac_to_vect(Fac)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/fac_to_vect.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Vectorize Fac object — fac_to_vect","text":"Fac Fac object CMTF ACMTF","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/fac_to_vect.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Vectorize Fac object — fac_to_vect","text":"Vectorized Fac object","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/fac_to_vect.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Vectorize Fac object — fac_to_vect","text":"","code":"set.seed(123) A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2)) Fac = list(A, B, C, D, E) v = fac_to_vect(Fac)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeACMTF.html","id":null,"dir":"Reference","previous_headings":"","what":"Initialize input vectors for the ACMTF algorithm — initializeACMTF","title":"Initialize input vectors for the ACMTF algorithm — initializeACMTF","text":"Initialize input vectors ACMTF algorithm","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeACMTF.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Initialize input vectors for the ACMTF algorithm — initializeACMTF","text":"","code":"initializeACMTF(   Z,   numComponents,   initialization = \"random\",   output = \"Fac\",   Y = NULL )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeACMTF.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Initialize input vectors for the ACMTF algorithm — initializeACMTF","text":"Z List object generated setupCMTFdata(). numComponents Integer stating number desired components CMTF model. initialization Initialization method, either \"random\" \"nvec\" (default \"random\"). Random initialize random input vectors. Nvec initialize vectors according singular value decomposition (matricized, needed) concatenated datasets per mode. output return output: \"Fac\" object (default) vectorized (\"vect\"). Y Used dependent variable initialization set \"npls\". used default.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeACMTF.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Initialize input vectors for the ACMTF algorithm — initializeACMTF","text":"List vector initialized input vectors per mode.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeACMTF.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Initialize input vectors for the ACMTF algorithm — initializeACMTF","text":"","code":"A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  init = initializeACMTF(Z, 2)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeCMTF.html","id":null,"dir":"Reference","previous_headings":"","what":"Initialize input vectors for the CMTF algorithm — initializeCMTF","title":"Initialize input vectors for the CMTF algorithm — initializeCMTF","text":"Initialize input vectors CMTF algorithm","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeCMTF.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Initialize input vectors for the CMTF algorithm — initializeCMTF","text":"","code":"initializeCMTF(   Z,   numComponents,   initialization = \"random\",   output = \"Fac\",   Y = NULL )"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeCMTF.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Initialize input vectors for the CMTF algorithm — initializeCMTF","text":"Z List object generated setupCMTFdata(). numComponents Integer stating number desired components CMTF model. initialization Initialization method, either \"random\" \"nvec\" (default \"random\"). Random initialize random input vectors. Nvec initialize vectors according singular value decomposition (matricized, needed) concatenated datasets per mode. output return output: \"Fac\" object (default) vectorized (\"vect\"). Y Used dependent variable initialization set \"npls\". used default.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeCMTF.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Initialize input vectors for the CMTF algorithm — initializeCMTF","text":"List vector initialized input vectors per mode.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/initializeCMTF.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Initialize input vectors for the CMTF algorithm — initializeCMTF","text":"","code":"set.seed(123) A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  init = initializeCMTF(Z, 1)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/normalizeFac.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalize all vectors in model output Fac object to norm 1. — normalizeFac","title":"Normalize all vectors in model output Fac object to norm 1. — normalizeFac","text":"Normalize vectors model output Fac object norm 1.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/normalizeFac.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalize all vectors in model output Fac object to norm 1. — normalizeFac","text":"","code":"normalizeFac(Fac, modes)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/normalizeFac.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Normalize all vectors in model output Fac object to norm 1. — normalizeFac","text":"Fac List object components per mode per item. modes List object modes per dataset (see also setupCMTFdata())","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/normalizeFac.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalize all vectors in model output Fac object to norm 1. — normalizeFac","text":"List object normalized Fac object, extracted norms per loading vector per component, norms per dataset per component.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/normalizeFac.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Normalize all vectors in model output Fac object to norm 1. — normalizeFac","text":"","code":"set.seed(123) A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2)) modes = list(c(1,2,3), c(1,4,5))  Fac = list(A, B, C, D, E) output = normalizeFac(Fac, modes)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/npred.html","id":null,"dir":"Reference","previous_headings":"","what":"Predict Y for new data by projecting the data onto the latent space defined by an ACMTF-R model. — npred","title":"Predict Y for new data by projecting the data onto the latent space defined by an ACMTF-R model. — npred","text":"Predict Y new data projecting data onto latent space defined ACMTF-R model.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/npred.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Predict Y for new data by projecting the data onto the latent space defined by an ACMTF-R model. — npred","text":"","code":"npred(model, newX, Z, sharedMode = 1)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/npred.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Predict Y for new data by projecting the data onto the latent space defined by an ACMTF-R model. — npred","text":"model ACMTF-R model newX List object new data, element corresponds block Z Original input data used model sharedMode Shared mode blocks (default 1).","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/npred.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Predict Y for new data by projecting the data onto the latent space defined by an ACMTF-R model. — npred","text":"Ypred: predicted value Y new data","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/npred.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Predict Y for new data by projecting the data onto the latent space defined by an ACMTF-R model. — npred","text":"","code":"set.seed(123) A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100, 2)) E = array(rnorm(10*2), c(10, 2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes) Y = matrix(A[,1]) # Remove a sample and define i = 1 Xtest = lapply(Z$object, function(x){x@data[i,,]}) Ytest = Y[i] Xtrain = lapply(Z$object, function(x){x@data[-i,,]}) Ytrain = Y[-i] Ztrain = setupCMTFdata(Xtrain, Z$modes) model = acmtfr_opt(Ztrain,Ytrain,1,initialization=\"random\",pi=1, nstart=1, max_iter=10) Ypred = npred(model, Xtest, Ztrain, sharedMode=1)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateFac.html","id":null,"dir":"Reference","previous_headings":"","what":"Reinflate all datablocks from a model Fac object. — reinflateFac","title":"Reinflate all datablocks from a model Fac object. — reinflateFac","text":"Basically wrapper function reinflateTensor() reinflateMatrix().","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateFac.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Reinflate all datablocks from a model Fac object. — reinflateFac","text":"","code":"reinflateFac(Fac, Z, returnAsTensor = FALSE)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateFac.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Reinflate all datablocks from a model Fac object. — reinflateFac","text":"Fac Fac object output CMTF ACMTF Z Z object generated setupCMTFdata(). returnAsTensor Boolean return data blocks rTensor tensor objects (default FALSE)","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateFac.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Reinflate all datablocks from a model Fac object. — reinflateFac","text":"List data blocks","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateFac.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Reinflate all datablocks from a model Fac object. — reinflateFac","text":"","code":"set.seed(123) A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  result = cmtf_opt(Z, 1, max_iter=2) Xhats = reinflateFac(result$Fac, Z)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateMatrix.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a matrix from a matrix of scores and loadings similar to a component model. — reinflateMatrix","title":"Create a matrix from a matrix of scores and loadings similar to a component model. — reinflateMatrix","text":"Create matrix matrix scores loadings similar component model.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateMatrix.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a matrix from a matrix of scores and loadings similar to a component model. — reinflateMatrix","text":"","code":"reinflateMatrix(A, B)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateMatrix.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create a matrix from a matrix of scores and loadings similar to a component model. — reinflateMatrix","text":"x N matrix corresponding scores N components. B J x N matrix corresponding loadings N components.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateMatrix.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a matrix from a matrix of scores and loadings similar to a component model. — reinflateMatrix","text":"M, x J matrix.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateMatrix.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create a matrix from a matrix of scores and loadings similar to a component model. — reinflateMatrix","text":"","code":"A = rnorm(108) B = rnorm(100) M = reinflateMatrix(A,B)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateTensor.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a tensor out of a set of matrices similar to a component model. — reinflateTensor","title":"Create a tensor out of a set of matrices similar to a component model. — reinflateTensor","text":"Create tensor set matrices similar component model.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateTensor.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a tensor out of a set of matrices similar to a component model. — reinflateTensor","text":"","code":"reinflateTensor(A, B, C)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateTensor.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create a tensor out of a set of matrices similar to a component model. — reinflateTensor","text":"x N matrix corresponding loadings first mode N components. B J x N matrix corresponding loadings second mode N components. C K x N matrix corresponding loadings third mode N components.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateTensor.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a tensor out of a set of matrices similar to a component model. — reinflateTensor","text":"M, x J x K tensor.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/reinflateTensor.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create a tensor out of a set of matrices similar to a component model. — reinflateTensor","text":"","code":"A = rnorm(108) B = rnorm(100) C = rnorm(10) M = reinflateTensor(A,B,C)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/removeTwoNormCol.html","id":null,"dir":"Reference","previous_headings":"","what":"Remove two-norms column-wise from a matrix — removeTwoNormCol","title":"Remove two-norms column-wise from a matrix — removeTwoNormCol","text":"Remove two-norms column-wise matrix","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/removeTwoNormCol.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Remove two-norms column-wise from a matrix — removeTwoNormCol","text":"","code":"removeTwoNormCol(df)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/removeTwoNormCol.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Remove two-norms column-wise from a matrix — removeTwoNormCol","text":"df Matrix loadings","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/removeTwoNormCol.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Remove two-norms column-wise from a matrix — removeTwoNormCol","text":"Matrix loadings column-wise 2-norm 1.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/removeTwoNormCol.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Remove two-norms column-wise from a matrix — removeTwoNormCol","text":"","code":"A = array(rnorm(108*4), c(108,4)) Anorm = removeTwoNormCol(A)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/setupCMTFdata.html","id":null,"dir":"Reference","previous_headings":"","what":"Set up datasets for (A)CMTF input — setupCMTFdata","title":"Set up datasets for (A)CMTF input — setupCMTFdata","text":"Set datasets ()CMTF input","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/setupCMTFdata.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set up datasets for (A)CMTF input — setupCMTFdata","text":"","code":"setupCMTFdata(datasets, modes, normalize = TRUE)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/setupCMTFdata.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set up datasets for (A)CMTF input — setupCMTFdata","text":"datasets List arrays datasets. Multi-way two-way may combined. modes Numbered modes per dataset list. Example element 1: 1 2 3 element 2: 1 4 X tensor Y matrix case shared subject mode. normalize Boolean specifying datasets normalized Frobenium norm 1. Note: function puts zeroes positions missing values. indices missing data conserved output.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/setupCMTFdata.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Set up datasets for (A)CMTF input — setupCMTFdata","text":"Z, list \"object\" listing datasets, \"sizes\" size, \"norms\" norms \"missing\" stating missing data.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/setupCMTFdata.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Set up datasets for (A)CMTF input — setupCMTFdata","text":"","code":"set.seed(123) A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/vect_to_fac.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert vectorized output of (a)cmtf to a Fac list object with all loadings per mode. — vect_to_fac","title":"Convert vectorized output of (a)cmtf to a Fac list object with all loadings per mode. — vect_to_fac","text":"Convert vectorized output ()cmtf Fac list object loadings per mode.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/vect_to_fac.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert vectorized output of (a)cmtf to a Fac list object with all loadings per mode. — vect_to_fac","text":"","code":"vect_to_fac(vect, Z, sortComponents = FALSE)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/vect_to_fac.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert vectorized output of (a)cmtf to a Fac list object with all loadings per mode. — vect_to_fac","text":"vect Vectorized output ()cmtf Z Original Z input object (see setupCMTFdata). sortComponents Sort order components variation explained (default FALSE).","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/vect_to_fac.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert vectorized output of (a)cmtf to a Fac list object with all loadings per mode. — vect_to_fac","text":"Fac: list object loadings components per mode, ordered way Z$modes.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/reference/vect_to_fac.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert vectorized output of (a)cmtf to a Fac list object with all loadings per mode. — vect_to_fac","text":"","code":"set.seed(123) A = array(rnorm(108*2), c(108, 2)) B = array(rnorm(100*2), c(100, 2)) C = array(rnorm(10*2), c(10, 2)) D = array(rnorm(100*2), c(100,2)) E = array(rnorm(10*2), c(10,2))  df1 = reinflateTensor(A, B, C) df2 = reinflateTensor(A, D, E) datasets = list(df1, df2) modes = list(c(1,2,3), c(1,4,5)) Z = setupCMTFdata(datasets, modes, normalize=FALSE)  result = cmtf_opt(Z, 2, initialization=\"random\", max_iter = 2) Fac = vect_to_fac(result$par, Z)"},{"path":"https://grvanderploeg.com/CMTFtoolbox/news/index.html","id":"cmtftoolbox-101","dir":"Changelog","previous_headings":"","what":"CMTFtoolbox 1.0.1","title":"CMTFtoolbox 1.0.1","text":"CRAN release: 2025-08-22 Small edits DESCRIPTION fulfill CRAN guidelines. Messages printed console using fitting functions can now suppressed. Edited example ACMTF_modelSelection run within 5s.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/news/index.html","id":"cmtftoolbox-100","dir":"Changelog","previous_headings":"","what":"CMTFtoolbox 1.0.0","title":"CMTFtoolbox 1.0.0","text":"Initial CRAN submission.","code":""},{"path":"https://grvanderploeg.com/CMTFtoolbox/news/index.html","id":"cmtftoolbox-010","dir":"Changelog","previous_headings":"","what":"CMTFtoolbox 0.1.0","title":"CMTFtoolbox 0.1.0","text":"Added NEWS.md.","code":""}]
